<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChromaZen - Inspiration Color Tool v3.2.2</title>
    
    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#121212',
                            surface: '#1E1E1E',
                            border: '#333333',
                            text: '#EDEDED',
                            muted: '#A1A1AA'
                        }
                    },
                    animation: {
                        'pop': 'pop 0.3s ease-in-out',
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Abril+Fatface&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #F5F5F7;
            color: #1D1D1F;
            transition: background-color 0.3s, color 0.3s;
        }
        body.dark { background-color: #121212; color: #EDEDED; }

        /* UI Elements */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%;
            background: #FFFFFF; cursor: pointer; margin-top: -7px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); border: 1px solid rgba(0,0,0,0.1);
        }
        .dark input[type=range]::-webkit-slider-thumb { background: #333; border-color: #555; }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #E5E5E5; border-radius: 2px;
        }
        .dark input[type=range]::-webkit-slider-runnable-track { background: #333; }

        .color-panel { transition: background-color 0.6s cubic-bezier(0.16, 1, 0.3, 1), width 0.3s ease; }
        .panel-locked { box-shadow: inset 0 0 0 4px rgba(0,0,0,0.1); }
        .dark .panel-locked { box-shadow: inset 0 0 0 4px rgba(255,255,255,0.15); }
        .panel-dragging { opacity: 0.5; transform: scale(0.98); z-index: 50; }

        /* Contrast Badge */
        .contrast-badge {
            position: absolute; right: -12px; top: 50%; transform: translateY(-50%); z-index: 10;
            background: white; color: black; border: 1px solid #eee; padding: 2px 6px; border-radius: 999px;
            font-size: 10px; font-weight: bold; opacity: 0; transition: opacity 0.2s; pointer-events: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .color-panel:hover + .color-panel .contrast-badge,
        .color-panel:hover .contrast-badge { opacity: 1; }
        .dark .contrast-badge { background: #333; color: white; border-color: #444; }

        #toast { backdrop-filter: blur(12px); background: rgba(0,0,0,0.85); color: white; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .dark #toast { background: rgba(255,255,255,0.9); color: black; }
        .modal-backdrop { backdrop-filter: blur(5px); background: rgba(0,0,0,0.4); }
        .dark .modal-backdrop { background: rgba(0,0,0,0.8); }

        .scrollbar-thin::-webkit-scrollbar { width: 4px; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background-color: #DDD; border-radius: 2px; }
        .dark .scrollbar-thin::-webkit-scrollbar-thumb { background-color: #333; }

        @keyframes pop {
            0% { transform: scale(1); } 40% { transform: scale(0.95); } 70% { transform: scale(1.05); } 100% { transform: scale(1); }
        }
        .btn-pop { animation: pop 0.3s ease-in-out; }
        
        /* Sidebar Transition */
        aside { 
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), padding 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease; 
            will-change: width, padding;
        }
        .sidebar-closed { 
            width: 0 !important; 
            padding: 0 !important; 
            opacity: 0 !important; 
            overflow: hidden !important; 
            border-right: none !important; 
            border: none !important;
            margin: 0 !important;
        }

        /* Custom Dropdown */
        .custom-select { position: relative; width: 100%; }
        .select-selected {
            background-color: transparent; color: inherit; padding: 10px 12px; border: 1px solid #e5e7eb;
            border-radius: 8px; cursor: pointer; user-select: none; font-size: 0.75rem; font-weight: 500;
            display: flex; justify-content: space-between; align-items: center; background-color: #f9fafb;
        }
        .dark .select-selected { background-color: #121212; border-color: #333; color: #e5e7eb; }
        .select-items {
            position: absolute; background-color: #fff; top: 110%; left: 0; right: 0; z-index: 99;
            border: 1px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            overflow: hidden; display: none;
        }
        .dark .select-items { background-color: #1e1e1e; border-color: #333; }
        .select-items div {
            color: #374151; padding: 8px 12px; cursor: pointer; user-select: none; font-size: 0.75rem;
        }
        .dark .select-items div { color: #e5e7eb; }
        .select-items div:hover { background-color: #f3f4f6; }
        .dark .select-items div:hover { background-color: #333; }
        .select-hide { display: none; }
        .select-arrow-active { transform: rotate(180deg); }

        /* Typography Styles */
        .font-abril { font-family: 'Abril Fatface', cursive; }
    </style>
</head>
<body class="h-screen w-full flex flex-col overflow-hidden select-none transition-colors duration-300">

    <!-- Header -->
    <header class="h-16 flex items-center justify-between px-4 md:px-6 bg-white dark:bg-dark-surface border-b border-gray-200 dark:border-dark-border z-20 shrink-0 transition-colors">
        <div class="flex items-center gap-3">
            <button onclick="App.ui.toggleSidebar()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-bg text-gray-500 transition-colors" title="Toggle Sidebar (Zen Mode)">
                <i data-lucide="menu" class="w-5 h-5"></i>
            </button>
            <div class="flex items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity" onclick="window.location.reload()" title="Reload App">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-tr from-indigo-500 to-purple-500 flex items-center justify-center text-white shadow-md">
                    <i data-lucide="palette" class="w-4 h-4"></i>
                </div>
                <h1 class="text-lg font-bold tracking-tight text-gray-900 dark:text-white leading-none hidden md:block">ChromaZen <span class="text-[10px] font-medium text-gray-400 dark:text-gray-500 ml-1">v3.2.2</span></h1>
            </div>
        </div>
        
        <div class="flex items-center gap-3">
            <!-- View Modes -->
            <div class="hidden md:flex bg-gray-100 dark:bg-dark-bg p-1 rounded-lg border dark:border-dark-border">
                <button onclick="App.ui.setViewMode('palette')" id="view-palette" class="view-btn px-3 py-1.5 text-xs font-semibold rounded-md flex items-center gap-1.5 transition-all bg-white dark:bg-dark-surface shadow-sm"><i data-lucide="columns" class="w-3 h-3"></i> Palette</button>
                <button onclick="App.ui.setViewMode('gradient')" id="view-gradient" class="view-btn px-3 py-1.5 text-xs font-semibold rounded-md flex items-center gap-1.5 transition-all text-gray-500 dark:text-gray-400"><i data-lucide="activity" class="w-3 h-3"></i> Gradient</button>
                <button onclick="App.ui.setViewMode('mockup')" id="view-mockup" class="view-btn px-3 py-1.5 text-xs font-semibold rounded-md flex items-center gap-1.5 transition-all text-gray-500 dark:text-gray-400"><i data-lucide="layout-template" class="w-3 h-3"></i> Mockup</button>
                <button onclick="App.ui.setViewMode('typography')" id="view-typography" class="view-btn px-3 py-1.5 text-xs font-semibold rounded-md flex items-center gap-1.5 transition-all text-gray-500 dark:text-gray-400"><i data-lucide="type" class="w-3 h-3"></i> Typography</button>
            </div>

            <div class="h-6 w-px bg-gray-200 dark:bg-dark-border hidden md:block"></div>

            <button onclick="App.logic.savePalette()" class="p-2 rounded-lg border border-gray-200 dark:border-dark-border text-gray-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-dark-bg transition-colors" title="Save to Library">
                <i data-lucide="heart" class="w-4 h-4"></i>
            </button>
            
            <button onclick="App.utils.shareUrl()" class="p-2 rounded-lg border border-gray-200 dark:border-dark-border text-gray-500 hover:text-indigo-500 hover:bg-indigo-50 dark:hover:bg-dark-bg transition-colors" title="Share URL">
                <i data-lucide="link" class="w-4 h-4"></i>
            </button>

            <!-- Export -->
            <div class="relative z-50">
                <button onclick="App.ui.toggleExportMenu(event)" class="px-3 py-2 text-xs font-medium rounded-lg bg-black dark:bg-white text-white dark:text-black hover:opacity-90 transition-all flex items-center gap-2">
                    <i data-lucide="download" class="w-3 h-3"></i> Export
                </button>
                <div id="export-menu" class="absolute right-0 mt-2 w-48 bg-white dark:bg-dark-surface rounded-xl shadow-xl border border-gray-100 dark:border-dark-border hidden p-1 z-50">
                    <button onclick="App.exports.image()" class="w-full text-left px-3 py-2 text-xs hover:bg-gray-50 dark:hover:bg-dark-bg dark:text-gray-200 rounded-lg flex items-center gap-2"><i data-lucide="image" class="w-3 h-3 text-pink-500"></i> Image (PNG)</button>
                    <button onclick="App.exports.css()" class="w-full text-left px-3 py-2 text-xs hover:bg-gray-50 dark:hover:bg-dark-bg dark:text-gray-200 rounded-lg flex items-center gap-2"><i data-lucide="code" class="w-3 h-3 text-blue-500"></i> CSS Variables</button>
                    <button onclick="App.exports.tailwind()" class="w-full text-left px-3 py-2 text-xs hover:bg-gray-50 dark:hover:bg-dark-bg dark:text-gray-200 rounded-lg flex items-center gap-2"><i data-lucide="wind" class="w-3 h-3 text-cyan-500"></i> Tailwind Config</button>
                    <button onclick="App.exports.ase()" class="w-full text-left px-3 py-2 text-xs hover:bg-gray-50 dark:hover:bg-dark-bg dark:text-gray-200 rounded-lg flex items-center gap-2"><i data-lucide="file-box" class="w-3 h-3 text-purple-500"></i> Adobe ASE</button>
                </div>
            </div>

            <!-- Grayscale Toggle -->
            <button onclick="App.ui.toggleGrayscale()" id="btn-grayscale" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors relative" title="Toggle Grayscale">
                <i data-lucide="eye" class="w-5 h-5"></i>
            </button>

            <!-- Sound Toggle -->
            <button onclick="App.ui.toggleSound()" id="btn-sound" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors" title="Toggle Sound">
                <i data-lucide="volume-x" class="w-5 h-5"></i>
            </button>

            <!-- Help/Shortcuts -->
            <button onclick="App.ui.showHelp()" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors" title="Help & Shortcuts">
                <i data-lucide="help-circle" class="w-5 h-5"></i>
            </button>

            <!-- Dark Mode -->
            <button onclick="App.ui.toggleDarkMode()" class="p-2 text-gray-400 hover:text-yellow-500 transition-colors" title="Toggle Dark Mode">
                <i data-lucide="sun" class="w-5 h-5 dark:hidden"></i><i data-lucide="moon" class="w-5 h-5 hidden dark:block"></i>
            </button>
        </div>
    </header>

    <main class="flex-1 flex flex-col md:flex-row relative overflow-hidden bg-gray-50 dark:bg-dark-bg transition-colors" id="app-main">
        
        <!-- Sidebar -->
        <aside id="sidebar" class="w-full md:w-80 bg-white dark:bg-dark-surface border-r border-gray-200 dark:border-dark-border p-5 flex flex-col gap-6 z-10 overflow-y-auto scrollbar-thin shrink-0">
            
            <!-- Generate -->
            <div class="space-y-3">
                <div class="flex bg-gray-100 dark:bg-dark-bg p-1 rounded-lg w-full border dark:border-dark-border">
                    <button data-mode="2" class="mode-btn flex-1 py-1.5 text-xs font-semibold rounded-md text-gray-500" onclick="App.logic.setMode(2)">2</button>
                    <button data-mode="3" class="mode-btn flex-1 py-1.5 text-xs font-semibold rounded-md shadow-sm bg-white dark:bg-dark-surface" onclick="App.logic.setMode(3)">3</button>
                    <button data-mode="4" class="mode-btn flex-1 py-1.5 text-xs font-semibold rounded-md text-gray-500" onclick="App.logic.setMode(4)">4</button>
                    <button data-mode="5" class="mode-btn flex-1 py-1.5 text-xs font-semibold rounded-md text-gray-500" onclick="App.logic.setMode(5)">5</button>
                </div>
                <button id="btn-generate" onclick="App.logic.generate(true, event)" 
                    onmouseenter="App.ui.updateInfo('Tip: Shift + Click for Smart Shuffle (í†¤ ìœ ì§€, ìƒ‰ì¡° ë³€ê²½)')" 
                    onmouseleave="App.ui.resetInfo()"
                    class="w-full py-3.5 bg-black dark:bg-white dark:text-black text-white rounded-xl text-base font-bold shadow-lg hover:shadow-xl active:scale-95 transition-all flex items-center justify-center gap-2 group">
                    <i data-lucide="shuffle" class="w-4 h-4 group-hover:rotate-180 transition-transform duration-500"></i> Generate
                </button>
            </div>

            <!-- Controls -->
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-bold text-gray-400 dark:text-dark-muted uppercase tracking-wider mb-2 block">Harmony Rule</label>
                    <!-- Custom Select for Hover Tips -->
                    <div class="custom-select" id="harmony-dropdown" 
                         onmouseenter="App.ui.updateInfo(App.logic.getInfoText(App.state.harmony))" 
                         onmouseleave="App.ui.resetInfo()">
                        <div class="select-selected" onclick="App.ui.toggleDropdown(event)">
                            <span id="selected-harmony">ðŸŽ² Random Shuffle</span>
                            <i data-lucide="chevron-down" class="w-4 h-4 transition-transform duration-200"></i>
                        </div>
                        <div class="select-items select-hide" id="harmony-items">
                            <!-- JS injected -->
                        </div>
                    </div>
                </div>
                <div onmouseenter="App.ui.updateInfo(App.logic.getInfoText('spread'))" onmouseleave="App.ui.resetInfo()">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-[10px] font-bold text-gray-400 dark:text-dark-muted uppercase tracking-wider">Spread</label>
                        <span id="variability-label" class="text-[10px] font-mono bg-gray-100 dark:bg-dark-bg px-1.5 py-0.5 rounded text-gray-500">30</span>
                    </div>
                    <input type="range" id="variability" min="5" max="100" value="30" class="w-full accent-black dark:accent-white" oninput="App.ui.updateSliderLabel(this.value)">
                </div>
            </div>

            <div class="border-t border-gray-100 dark:border-dark-border pt-4">
                <label class="text-[10px] font-bold text-gray-400 dark:text-dark-muted uppercase tracking-wider mb-2 block">Image Match</label>
                <div class="relative group" onmouseenter="App.ui.updateInfo(App.logic.getInfoText('imagematch'))" onmouseleave="App.ui.resetInfo()">
                    <input type="file" id="image-upload" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" onchange="App.logic.extractFromImage(this.files[0])">
                    <div class="w-full py-3 border-2 border-dashed border-gray-200 dark:border-dark-border rounded-xl flex items-center justify-center gap-2 text-xs font-medium text-gray-500 group-hover:border-indigo-500 group-hover:text-indigo-500 transition-colors bg-gray-50 dark:bg-dark-bg">
                        <i data-lucide="image-plus" class="w-4 h-4"></i> Upload / Ctrl+V
                    </div>
                </div>
            </div>

            <!-- 3-Tab System -->
            <div class="flex-1 flex flex-col min-h-0">
                <div class="flex border-b border-gray-100 dark:border-dark-border mb-3">
                    <button class="flex-1 pb-2 text-xs font-bold border-b-2 border-black dark:border-white text-black dark:text-white" id="tab-presets" onclick="App.ui.switchSidebarTab('presets')">Presets</button>
                    <button class="flex-1 pb-2 text-xs font-bold border-b-2 border-transparent text-gray-400 hover:text-gray-600" id="tab-library" onclick="App.ui.switchSidebarTab('library')">Library</button>
                    <button class="flex-1 pb-2 text-xs font-bold border-b-2 border-transparent text-gray-400 hover:text-gray-600" id="tab-history" onclick="App.ui.switchSidebarTab('history')">History</button>
                </div>
                
                <div id="sidebar-presets" class="flex-1 overflow-y-auto scrollbar-thin">
                    <div class="space-y-4" id="presets-grid"></div>
                </div>
                <div id="sidebar-library" class="flex-1 overflow-y-auto scrollbar-thin hidden">
                    <div id="library-container" class="space-y-2"></div>
                </div>
                <div id="sidebar-history" class="flex-1 overflow-y-auto scrollbar-thin hidden flex-col">
                    <div class="flex justify-end mb-2">
                        <button onclick="App.logic.clearHistory()" class="text-[10px] text-red-500 hover:text-red-700 font-bold uppercase tracking-wider flex items-center gap-1">
                            <i data-lucide="trash-2" class="w-3 h-3"></i> Clear History
                        </button>
                    </div>
                    <div id="history-container" class="grid grid-cols-4 gap-2"></div>
                </div>
            </div>

            <!-- Info Panel -->
            <div class="mt-2 mb-2 p-3 bg-gray-50 dark:bg-dark-bg border border-gray-100 dark:border-dark-border rounded-lg min-h-[60px] flex items-center shrink-0">
                <p id="info-text" class="text-xs text-gray-500 dark:text-gray-400 leading-snug">Hover over controls or presets for details.</p>
            </div>
        </aside>

        <!-- Main Display -->
        <div id="main-display" class="flex-1 relative w-full h-full bg-white dark:bg-dark-bg overflow-y-auto overflow-x-hidden">
            <div id="view-palette-content" class="w-full h-full flex flex-col md:flex-row"></div>
            
            <div id="view-gradient-content" class="hidden w-full h-full flex flex-col items-center justify-center p-10 gap-6">
                <div id="gradient-box" class="w-full max-w-4xl h-64 md:h-96 rounded-3xl shadow-2xl transition-all duration-300"></div>
                <!-- Gradient Angle Control -->
                <div class="flex items-center gap-4 bg-white dark:bg-dark-surface p-4 rounded-xl shadow-sm border border-gray-100 dark:border-dark-border">
                    <span class="text-xs font-bold uppercase text-gray-400">Angle</span>
                    <input type="range" min="0" max="360" value="90" class="w-32" oninput="App.ui.updateGradientAngle(this.value)">
                    <span class="text-xs font-mono w-8 text-right" id="grad-angle-val">90Â°</span>
                </div>
                <p class="font-mono text-xs md:text-sm bg-black/5 dark:bg-white/10 backdrop-blur-md px-4 py-2 rounded-lg cursor-pointer hover:bg-black/10 dark:hover:bg-white/20 transition-colors text-gray-600 dark:text-gray-300" id="gradient-css" onclick="App.utils.copy(this.innerText)">Code</p>
            </div>

            <!-- Sticky Remix Header for Mockup -->
            <div id="view-mockup-content" class="hidden w-full h-full relative">
                <div class="sticky top-0 z-30 w-full flex justify-between items-center p-4 pointer-events-none">
                    <!-- Scene Selector -->
                    <div class="pointer-events-auto bg-white dark:bg-dark-surface p-1 rounded-lg border border-gray-200 dark:border-dark-border shadow-sm flex gap-1">
                        <button onclick="App.ui.setMockupScene('landing')" class="mockup-scene-btn px-3 py-1.5 text-xs font-bold rounded-md bg-black text-white dark:bg-white dark:text-black">Landing</button>
                        <button onclick="App.ui.setMockupScene('app')" class="mockup-scene-btn px-3 py-1.5 text-xs font-bold rounded-md hover:bg-gray-100 dark:hover:bg-dark-bg text-gray-500">App</button>
                        <button onclick="App.ui.setMockupScene('dashboard')" class="mockup-scene-btn px-3 py-1.5 text-xs font-bold rounded-md hover:bg-gray-100 dark:hover:bg-dark-bg text-gray-500">Dash</button>
                        <button onclick="App.ui.setMockupScene('art')" class="mockup-scene-btn px-3 py-1.5 text-xs font-bold rounded-md hover:bg-gray-100 dark:hover:bg-dark-bg text-gray-500">Art</button>
                    </div>

                    <button id="btn-remix-mockup" onclick="App.logic.remix()" class="pointer-events-auto px-5 py-2.5 rounded-full shadow-lg font-bold flex items-center gap-2 transition-all hover:scale-105 active:scale-95 border-2 bg-white/80 backdrop-blur-sm dark:bg-black/80">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i> Remix Colors
                    </button>
                </div>
                
                <div class="max-w-6xl mx-auto space-y-6 pb-20 px-4 md:px-10 -mt-16 pt-20 animate-fade-in" id="mockup-inject-area">
                    <!-- Content injected via JS -->
                </div>
            </div>

            <!-- Sticky Remix Header for Typography -->
            <div id="view-typography-content" class="hidden w-full h-full relative">
                <div class="sticky top-0 z-30 w-full flex justify-between p-4 pointer-events-none items-center">
                    <div class="pointer-events-auto bg-white dark:bg-dark-surface p-1 rounded-lg border border-gray-200 dark:border-dark-border shadow-sm flex gap-1">
                        <button onclick="App.ui.setTypoStyle('modern')" class="typo-style-btn px-3 py-1.5 text-xs font-bold rounded-md bg-black text-white dark:bg-white dark:text-black">Modern</button>
                        <button onclick="App.ui.setTypoStyle('editorial')" class="typo-style-btn px-3 py-1.5 text-xs font-bold rounded-md hover:bg-gray-100 dark:hover:bg-dark-bg text-gray-500">Editorial</button>
                        <button onclick="App.ui.setTypoStyle('sns')" class="typo-style-btn px-3 py-1.5 text-xs font-bold rounded-md hover:bg-gray-100 dark:hover:bg-dark-bg text-gray-500">SNS</button>
                        <button onclick="App.ui.setTypoStyle('poster')" class="typo-style-btn px-3 py-1.5 text-xs font-bold rounded-md hover:bg-gray-100 dark:hover:bg-dark-bg text-gray-500">Poster</button>
                    </div>
                    
                    <button id="btn-remix-typo" onclick="App.logic.remix()" class="pointer-events-auto px-5 py-2.5 rounded-full shadow-lg font-bold flex items-center gap-2 transition-all hover:scale-105 active:scale-95 border-2 bg-white/80 backdrop-blur-sm dark:bg-black/80">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i> Remix Colors
                    </button>
                </div>

                <div class="max-w-5xl mx-auto space-y-6 pb-20 px-4 md:px-10 -mt-16 pt-20 animate-fade-in">
                    <div id="typo-inject-area" class="min-h-[800px] transition-colors duration-500"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Hidden Export -->
    <div id="export-container" class="fixed top-0 left-[-9999px] w-[1080px] h-[1080px] bg-white flex flex-col pointer-events-none opacity-100 z-[-1]">
        <div class="flex-1 flex" id="export-palette-area"></div>
        <div class="h-32 bg-white flex items-center justify-between px-12 border-t border-gray-100">
            <div><h2 class="text-4xl font-bold text-gray-900 tracking-tight">ChromaZen</h2></div>
            <div class="flex gap-6 font-mono text-xl text-gray-600 font-medium" id="export-codes"></div>
        </div>
    </div>

    <!-- Modals -->
    <div id="modal-container" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 modal-backdrop opacity-0 transition-opacity duration-200"></div>
    <div id="toast" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 px-5 py-3 rounded-full flex items-center gap-3 opacity-0 pointer-events-none transition-all duration-300 z-50 translate-y-4">
        <span class="text-sm font-medium" id="toast-message">Notification</span>
    </div>

    <script>
        const NAMED_COLORS = [
            {r:255,g:255,b:255,n:"White"},{r:0,g:0,b:0,n:"Black"},{r:255,g:0,b:0,n:"Red"},{r:0,g:255,b:0,n:"Lime"},{r:0,g:0,b:255,n:"Blue"},
            {r:255,g:255,b:0,n:"Yellow"},{r:0,g:255,b:255,n:"Cyan"},{r:255,g:0,b:255,n:"Magenta"},{r:192,g:192,b:192,n:"Silver"},{r:128,g:128,b:128,n:"Gray"},
            {r:128,g:0,b:0,n:"Maroon"},{r:128,g:128,b:0,n:"Olive"},{r:0,g:128,b:0,n:"Green"},{r:128,g:0,b:128,n:"Purple"},{r:0,g:128,b:128,n:"Teal"},
            {r:0,g:0,b:128,n:"Navy"},{r:255,g:165,b:0,n:"Orange"},{r:255,g:99,b:71,n:"Tomato"},{r:255,g:69,b:0,n:"Red Orange"},{r:255,g:215,b:0,n:"Gold"},
            {r:218,g:165,b:32,n:"Goldenrod"},{r:75,g:0,b:130,n:"Indigo"},{r:60,g:179,b:113,n:"Sea Green"},{r:32,g:178,b:170,n:"Light Sea Green"},{r:0,g:191,b:255,n:"Deep Sky Blue"},
            {r:70,g:130,b:180,n:"Steel Blue"},{r:135,g:206,b:235,n:"Sky Blue"},{r:25,g:25,b:112,n:"Midnight Blue"},{r:220,g:20,b:60,n:"Crimson"},{r:255,g:20,b:147,n:"Deep Pink"},
            {r:255,g:182,b:193,n:"Light Pink"},{r:255,g:140,b:0,n:"Dark Orange"},{r:255,g:127,b:80,n:"Coral"},{r:233,g:150,b:122,n:"Dark Salmon"},{r:245,g:222,b:179,n:"Wheat"},
            {r:210,g:105,b:30,n:"Chocolate"},{r:139,g:69,b:19,n:"Saddle Brown"},{r:160,g:82,b:45,n:"Sienna"},{r:240,g:248,b:255,n:"Alice Blue"},{r:47,g:79,b:79,n:"Dark Slate Gray"},
            {r:112,g:128,b:144,n:"Slate Gray"},{r:105,g:105,b:105,n:"Dim Gray"},{r:255,g:228,b:181,n:"Moccasin"},{r:255,g:228,b:196,n:"Bisque"},
            {r:250,g:128,b:114,n:"Salmon"},{r:255,g:160,b:122,n:"Light Salmon"},{r:255,g:218,b:185,n:"Peach Puff"},{r:255,g:222,b:173,n:"Navajo White"},{r:255,g:228,b:225,n:"Misty Rose"},
            {r:255,g:240,b:245,n:"Lavender Blush"},{r:255,g:250,b:250,n:"Snow"},{r:248,g:248,b:255,n:"Ghost White"},{r:245,g:245,b:245,n:"White Smoke"},{r:220,g:220,b:220,n:"Gainsboro"},
            {r:211,g:211,b:211,n:"Light Gray"},{r:169,g:169,b:169,n:"Dark Gray"},{r:255,g:255,b:224,n:"Light Yellow"},{r:255,g:255,b:240,n:"Ivory"},{r:255,g:239,b:213,n:"Papaya Whip"},
            {r:255,g:235,b:205,n:"Blanched Almond"},{r:188,g:143,b:143,n:"Rosy Brown"},{r:205,g:92,b:92,n:"Indian Red"},{r:165,g:42,b:42,n:"Brown"},{r:178,g:34,b:34,n:"Firebrick"},
            {r:139,g:0,b:0,n:"Dark Red"},{r:154,g:205,b:50,n:"Yellow Green"},{r:85,g:107,b:47,n:"Dark Olive Green"},{r:107,g:142,b:35,n:"Olive Drab"},{r:124,g:252,b:0,n:"Lawn Green"},
            {r:127,g:255,b:0,n:"Chartreuse"},{r:173,g:255,b:47,n:"Green Yellow"},{r:50,g:205,b:50,n:"Lime Green"},{r:144,g:238,b:144,n:"Light Green"},{r:152,g:251,b:152,n:"Pale Green"},
            {r:0,g:250,b:154,n:"Medium Spring Green"},{r:0,g:255,b:127,n:"Spring Green"},{r:46,g:139,b:87,n:"Sea Green"},{r:34,g:139,b:34,n:"Forest Green"},{r:0,g:128,b:0,n:"Green"},
            {r:0,g:100,b:0,n:"Dark Green"},{r:102,g:205,b:170,n:"Medium Aquamarine"},{r:0,g:255,b:255,n:"Aqua"},{r:0,g:255,b:255,n:"Cyan"},{r:224,g:255,b:255,n:"Light Cyan"},{r:175,g:238,b:238,n:"Pale Turquoise"},
            {r:127,g:255,b:212,n:"Aquamarine"},{r:240,g:255,b:255,n:"Azure"},{r:245,g:255,b:250,n:"Mint Cream"},{r:255,g:255,b:255,n:"White"}
        ];

        const CONFIG = {
            SPREAD_MULTIPLIER: 0.6,
            BASE_OFFSET: 10,
            MONO_L_STEP: 12, MONO_S_STEP: 5, MONO_L_LIMIT_LOW: 5, MONO_L_LIMIT_HIGH: 95,
            COMPLEMENTARY_HUE_SHIFT: 180, TRIADIC_HUE_SHIFT: 120, RANDOM_NOISE: 20
        };

        const PRESET_CATEGORIES = {
            'Social Vibes': ['warm', 'neon', 'vivid', 'minimal'],
            'Business': ['corporate', 'dark', 'grayscale', 'tech'],
            'Marketing': ['luxury', 'retro', 'pastel', 'coffee'],
            'Art & Nature': ['nature', 'cyberpunk', 'wedding', 'forest', 'sunset'],
            'Seasonal': ['spring', 'summer', 'autumn', 'winter'],
            'Kids & Pop': ['kids', 'pop', 'candy']
        };

        const App = {
            state: {
                mode: 3, colors: [], locked: [false,false,false,false,false], variability: 30, preset: 'none', harmony: 'random',
                history: [], library: [],
                undoStack: [], redoStack: [], viewMode: 'palette', grain: false, darkMode: false, editingIndex: -1,
                colorOffset: 0, mockupScene: 'landing', typoStyle: 'modern', sidebarOpen: true, activeTab: 'presets', soundEnabled: false,
                gradientAngle: 90, grayscaleMode: false, helpLang: 'ko', lastHelpTab: 'tips', openHelpSection: null
            },
            utils: {
                hslToHex: (h, s, l) => {
                    h = (h % 360 + 360) % 360; l /= 100; const a = s * Math.min(l, 1 - l) / 100;
                    const f = n => { const k = (n + h / 30) % 12; const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1); return Math.round(255 * color).toString(16).padStart(2, '0'); };
                    return `#${f(0)}${f(8)}${f(4)}`.toUpperCase();
                },
                hexToHsl: (hex) => {
                    let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                    let r = parseInt(result[1], 16)/255, g = parseInt(result[2], 16)/255, b = parseInt(result[3], 16)/255;
                    let max = Math.max(r, g, b), min = Math.min(r, g, b), h, s, l = (max + min) / 2;
                    if (max == min) h = s = 0; else {
                        let d = max - min; s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                        switch (max) { case r: h = (g - b) / d + (g < b ? 6 : 0); break; case g: h = (b - r) / d + 2; break; case b: h = (r - g) / d + 4; break; } h *= 60;
                    }
                    return { h: Math.round(h), s: Math.round(s*100), l: Math.round(l*100), hex: hex.toUpperCase() };
                },
                hexToRgbVal: (hex) => {
                    let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                    return result ? {r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16)} : {r:0,g:0,b:0};
                },
                getContrast: (hex1, hex2) => {
                    const lum = (hex) => {
                        let {r,g,b} = App.utils.hexToRgbVal(hex);
                        const a = [r/255, g/255, b/255].map(v => v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4));
                        return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
                    };
                    const l1 = lum(hex1), l2 = lum(hex2); return (Math.max(l1, l2) + 0.05) / (Math.min(l1, l2) + 0.05);
                },
                getContrastBadge: (r) => {
                    if(r >= 7) return `<span class="contrast-badge text-green-600 bg-green-50 border-green-200">AAA ${r.toFixed(1)}</span>`;
                    if(r >= 4.5) return `<span class="contrast-badge text-blue-600 bg-blue-50 border-blue-200">AA ${r.toFixed(1)}</span>`;
                    return `<span class="contrast-badge text-red-500 bg-red-50 border-red-200">Fail ${r.toFixed(1)}</span>`;
                },
                getTextColor: (bgColor) => { return App.utils.getContrast(bgColor, '#FFFFFF') > App.utils.getContrast(bgColor, '#000000') ? '#F8FAFC' : '#0F172A'; },
                copy: (text) => { navigator.clipboard.writeText(text).then(() => App.ui.showToast(`${text} copied!`)); },
                getColorDistance: (c1, c2) => {
                    return Math.sqrt(Math.pow(c1.r - c2.r, 2) + Math.pow(c1.g - c2.g, 2) + Math.pow(c1.b - c2.b, 2));
                },
                getColorName: (hex) => {
                    const rgb = App.utils.hexToRgbVal(hex);
                    let minDiff = Infinity;
                    let closest = "Color";
                    NAMED_COLORS.forEach(c => {
                        const diff = Math.sqrt(Math.pow(rgb.r - c.r, 2) + Math.pow(rgb.g - c.g, 2) + Math.pow(rgb.b - c.b, 2));
                        if(diff < minDiff) { minDiff = diff; closest = c.n; }
                    });
                    return closest;
                },
                playSound: () => {
                    if (!App.state.soundEnabled) return;
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(400, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.15);
                    gain.gain.setValueAtTime(0.05, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.15);
                },
                shareUrl: () => {
                    const colors = App.state.colors.map(c => c.hex.replace('#', '')).join('-');
                    const url = window.location.href.split('#')[0] + '#' + colors;
                    navigator.clipboard.writeText(url).then(() => App.ui.showToast('URL copied to clipboard!'));
                },
                updateHash: () => {
                    if(App.state.colors.length === 0) return;
                    const hash = App.state.colors.map(c => c.hex.replace('#', '')).join('-');
                    window.history.replaceState(null, null, '#' + hash);
                },
                parseUrl: () => {
                    const hash = window.location.hash.substring(1);
                    if (!hash) return;
                    const hexes = hash.split('-');
                    if (hexes.length >= 2) {
                        App.state.colors = hexes.map(hex => App.utils.hexToHsl('#' + hex));
                        App.state.mode = hexes.length;
                        App.logic.setMode(hexes.length, false);
                        App.ui.render();
                    }
                }
            },
            logic: {
                getInfoText: (key) => {
                    const map = {
                        'vivid': 'ë†’ì€ ì±„ë„ì˜ ì—ë„ˆì§€ ë„˜ì¹˜ëŠ” ìƒ‰ìƒ', 'pastel': 'ë¶€ë“œëŸ½ê³  ì°¨ë¶„í•œ íŒŒìŠ¤í…” í†¤', 'dark': 'ì„¸ë ¨ë˜ê³  ë¬´ê²Œê° ìžˆëŠ” ì–´ë‘ìš´ í…Œë§ˆ',
                        'warm': 'ë”°ëœ»í•œ ë¹¨ê°•, ì£¼í™©, ë…¸ëž‘ ê³„ì—´', 'nature': 'ìžì—°ì—ì„œ ì˜ê°ì„ ë°›ì€ í™ê³¼ ìˆ²ì˜ ìƒ‰', 'neon': 'ì‚¬ì´ë²„íŽ‘í¬/ë‚˜ì´íŠ¸ë¼ì´í”„ ë„¤ì˜¨ ìŠ¤íƒ€ì¼',
                        'retro': 'ë¹›ë°”ëžœ ë¹ˆí‹°ì§€ ê°ì„±', 'corporate': 'ì‹ ë¢°ê°ì„ ì£¼ëŠ” ë¸”ë£¨/ê·¸ë ˆì´ í†¤', 'luxury': 'ê³¨ë“œ, ë¸”ëž™, ê¹Šì´ ìžˆëŠ” ê³ ê¸‰ìŠ¤ëŸ¬ì›€',
                        'wedding': 'ë¡œë§¨í‹±í•œ í™”ì´íŠ¸ì™€ ìš°ì•„í•œ í†¤', 'grayscale': 'ë¬´ì±„ìƒ‰/ì™€ì´ì–´í”„ë ˆìž„ ìŠ¤íƒ€ì¼', 'cyberpunk': 'ê³ ëŒ€ë¹„ ë„¤ì˜¨ ë‹¤í¬ ëª¨ë“œ',
                        'spread': 'ìƒ‰ìƒ ê°„ì˜ ê±°ë¦¬ë¥¼ ì¡°ì ˆí•©ë‹ˆë‹¤', 'harmony': 'ìƒ‰ì±„ ì¡°í™” ê·œì¹™ ì„ íƒ', 'imagematch': 'ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸°(Ctrl+V)ë¡œ ìƒ‰ìƒ ì¶”ì¶œ',
                        'random': 'ì™„ì „ ë¬´ìž‘ìœ„ ë°°ìƒ‰', 'analogous': 'ì¸ì ‘í•œ ìƒ‰ìƒë“¤ì˜ ì¡°í™” (ìœ ì‚¬ìƒ‰)', 'monochromatic': 'í•œ ê°€ì§€ ìƒ‰ìƒì˜ ëª…ë„ ë³€í™” (ë‹¨ìƒ‰)',
                        'complementary': 'ê°•ë ¬í•œ ëŒ€ë¹„ë¥¼ ì´ë£¨ëŠ” ë³´ìƒ‰', 'triadic': 'ê· í˜• ìž¡ížŒ 3ìƒ‰ ì¡°í™”',
                        'minimal': 'ìµœì†Œí•œì˜ ìƒ‰ìƒìœ¼ë¡œ ê¹”ë”í•œ ëŠë‚Œ', 'summer': 'ì—¬ë¦„ì˜ ì²­ëŸ‰í•¨ê³¼ ë°ì€ ì—ë„ˆì§€', 'forest': 'ê¹Šì€ ìˆ²ì†ì˜ ì°¨ë¶„í•¨', 'sunset': 'í•´ì§ˆë…˜ì˜ ë”°ëœ»í•˜ê³  ë‚­ë§Œì ì¸ ë¬´ë“œ',
                        'tech': 'ë¯¸ëž˜ì§€í–¥ì ì¸ ì°¨ê°€ìš´ í…Œí¬ ê°ì„±', 'berry': 'ë‹¬ì½¤í•˜ê³  ìƒí¼í•œ ë² ë¦¬ í†¤', 'coffee': 'ë”°ëœ»í•˜ê³  ë¶€ë“œëŸ¬ìš´ ë¸Œë¼ìš´ í†¤',
                        'spring': 'ë´„ì˜ í™”ì‚¬í•¨ê³¼ ìƒëª…ë ¥', 'autumn': 'ê°€ì„ì˜ ê¹Šê³  í’ë¶€í•œ ìƒ‰ê°', 'winter': 'ê²¨ìš¸ì˜ ì°¨ê°‘ê³  ê¹¨ë—í•œ ëŠë‚Œ',
                        'kids': 'ì•„ì´ë“¤ì„ ìœ„í•œ ë°ê³  ëª…ëž‘í•œ ìƒ‰ìƒ', 'pop': 'í†¡í†¡ íŠ€ëŠ” íŒì•„íŠ¸ ìŠ¤íƒ€ì¼', 'candy': 'ë‹¬ì½¤í•œ ì‚¬íƒ• ê°™ì€ íŒŒìŠ¤í…” í†¤'
                    };
                    return map[key] || 'ì»¨íŠ¸ë¡¤ì´ë‚˜ í”„ë¦¬ì…‹ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤ë³´ì„¸ìš”.';
                },
                init: () => {
                    try {
                        const lib = localStorage.getItem('chromazen_library');
                        if(lib) App.state.library = JSON.parse(lib);
                        
                        const hist = localStorage.getItem('chromazen_history');
                        if(hist) App.state.history = JSON.parse(hist);
                    } catch(e) { 
                        console.error('Storage load error', e); 
                        App.state.library = [];
                        App.state.history = [];
                    }

                    if (localStorage.getItem('chromazen_dark') === 'true' || (!('chromazen_dark' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                        App.state.darkMode = true; document.body.classList.add('dark');
                    }
                    App.ui.renderPresets(); App.ui.renderLibrary(); App.ui.initHarmonyDropdown();
                    if(window.location.hash) App.utils.parseUrl(); else { App.logic.setMode(3); App.logic.generate(false); }

                    document.body.onkeyup = (e) => {
                        if(document.activeElement.tagName === 'INPUT') return;
                        if(e.key === ' ' || e.code === 'Space') { e.preventDefault(); App.logic.generate(true, e); }
                        if((e.ctrlKey||e.metaKey) && e.key === 'z') App.logic.undo();
                        if((e.ctrlKey||e.metaKey) && e.key === 'y') App.logic.redo();
                        if(e.key === '?') App.ui.showHelp();
                        if(['1','2','3','4','5'].includes(e.key)) App.logic.toggleLock(parseInt(e.key)-1);
                    };
                    window.onclick = (e) => {
                        if (!e.target.closest('#harmony-dropdown')) {
                             document.getElementById('harmony-items').style.display = 'none';
                             const arrow = document.querySelector('.select-selected i');
                             if(arrow) arrow.classList.remove('select-arrow-active');
                        }
                        document.getElementById('export-menu').classList.add('hidden');
                    };
                    window.addEventListener('paste', (e) => {
                        if (e.clipboardData && e.clipboardData.items) {
                            for (let i = 0; i < e.clipboardData.items.length; i++) {
                                if (e.clipboardData.items[i].type.indexOf('image') !== -1) {
                                    const blob = e.clipboardData.items[i].getAsFile();
                                    App.logic.extractFromImage(blob);
                                    break;
                                }
                            }
                        }
                    });
                },
                setMode: (n, regenerate = true) => { 
                    if(regenerate) App.logic.saveState();
                    App.state.mode = n;
                    document.querySelectorAll('.mode-btn').forEach(b => {
                        b.classList.remove('bg-white','dark:bg-dark-surface','text-gray-900','dark:text-white','shadow-sm');
                        b.classList.add('text-gray-500','dark:text-gray-400');
                        if(parseInt(b.dataset.mode) === n) {
                            b.classList.add('bg-white','dark:bg-dark-surface','text-gray-900','dark:text-white','shadow-sm');
                            b.classList.remove('text-gray-500','dark:text-gray-400');
                        }
                    });
                    if(regenerate) App.logic.generate(false);
                    else App.ui.render(); 
                },
                generate: (pushHistory = true, e) => {
                    const isSmart = e && e.shiftKey;
                    if(pushHistory) App.logic.saveState();
                    App.state.colorOffset = 0;
                    App.utils.playSound();
                    const btn = document.getElementById('btn-generate');
                    if(btn) { btn.classList.remove('btn-pop'); void btn.offsetWidth; btn.classList.add('btn-pop'); }
                    
                    let newColors = [...App.state.colors];
                    while(newColors.length < 5) newColors.push(null);
                    let base = (App.state.locked[0] && newColors[0]) ? newColors[0] : App.logic.getRandomColor();
                    
                    if (!isSmart) newColors[0] = base; 

                    const spread = App.state.variability * CONFIG.SPREAD_MULTIPLIER; 
                    const rule = App.state.harmony;

                    for(let i=0; i<App.state.mode; i++) {
                        if(App.state.locked[i] && newColors[i]) continue;
                        let h, s, l;
                        if (isSmart && newColors[i]) {
                            h = Math.floor(Math.random() * 360); s = newColors[i].s; l = newColors[i].l;
                        } else {
                            if (i === 0) {
                                let rc = App.logic.getRandomColor();
                                h = rc.h; s = rc.s; l = rc.l;
                            } else {
                                let b = newColors[0];
                                h = b.h; s = b.s; l = b.l;
                                if (rule === 'analogous') h += spread * i;
                                else if (rule === 'monochromatic') {
                                    let lStep = (90 - b.l) / (App.state.mode); 
                                    if(b.l > 50) l = b.l - (i * CONFIG.MONO_L_STEP); else l = b.l + (i * CONFIG.MONO_L_STEP);
                                    l = Math.max(CONFIG.MONO_L_LIMIT_LOW, Math.min(CONFIG.MONO_L_LIMIT_HIGH, l));
                                    s = Math.max(0, s - (i * CONFIG.MONO_S_STEP));
                                } 
                                else if (rule === 'complementary') h += CONFIG.COMPLEMENTARY_HUE_SHIFT + ((Math.random()-0.5)*spread);
                                else if (rule === 'triadic') h += CONFIG.TRIADIC_HUE_SHIFT * i + ((Math.random()-0.5)*spread/2);
                                else { h += (spread + CONFIG.BASE_OFFSET) * i; let rc = App.logic.getRandomColor(); s = rc.s; l = rc.l; }
                                if(rule !== 'random') {
                                    const p = App.logic.getPresetConstraints();
                                    if (rule === 'monochromatic') {
                                        if(p.sMax > 0) s = Math.max(p.sMin, Math.min(p.sMax, s));
                                    } else {
                                        s = Math.max(p.sMin, Math.min(p.sMax, s + (Math.random()-0.5)*CONFIG.RANDOM_NOISE));
                                        l = Math.max(p.lMin, Math.min(p.lMax, l + (Math.random()-0.5)*CONFIG.RANDOM_NOISE));
                                    }
                                }
                            }
                        }
                        newColors[i] = { h, s, l, hex: App.utils.hslToHex(h,s,l) };
                    }
                    App.state.colors = newColors.slice(0, App.state.mode);
                    App.ui.render();
                    if(pushHistory) App.ui.addToHistory();
                    if(isSmart) App.ui.showToast("Smart Shuffle: í†¤ì€ ìœ ì§€ë˜ê³  ìƒ‰ì¡°ë§Œ ë³€ê²½ë¨");
                },
                remix: () => { App.state.colorOffset = (App.state.colorOffset + 1) % App.state.mode; App.ui.render(); },
                togglePreset: (name) => {
                    if (App.state.preset === name) { App.state.preset = 'none'; App.ui.showToast('Preset cleared'); } 
                    else { App.state.preset = name; }
                    App.ui.renderPresets(); App.logic.generate(); 
                },
                selectHarmony: (val, text) => {
                    App.state.harmony = val;
                    document.getElementById('selected-harmony').innerText = text;
                    App.logic.generate();
                    document.getElementById('harmony-items').style.display = 'none';
                    document.querySelector('.select-selected i').classList.remove('select-arrow-active');
                },
                getRandomColor: () => {
                    const p = App.logic.getPresetConstraints();
                    const h = p.hRange ? p.hRange[0] + Math.random()*(p.hRange[1]-p.hRange[0]) : Math.floor(Math.random()*360);
                    const s = p.sMin + Math.random()*(p.sMax-p.sMin);
                    const l = p.lMin + Math.random()*(p.lMax-p.lMin);
                    return { h, s, l, hex: App.utils.hslToHex(h,s,l) };
                },
                getPresetConstraints: () => {
                    const sets = {
                        pastel: { sMin: 40, sMax: 90, lMin: 75, lMax: 95 }, vivid: { sMin: 70, sMax: 100, lMin: 40, lMax: 65 },
                        dark: { sMin: 20, sMax: 60, lMin: 10, lMax: 30 }, warm: { sMin: 50, sMax: 90, lMin: 40, lMax: 80, hRange: [0, 60] },
                        nature: { sMin: 20, sMax: 60, lMin: 30, lMax: 70, hRange: [70, 160] }, neon: { sMin: 90, sMax: 100, lMin: 50, lMax: 60 },
                        retro: { sMin: 30, sMax: 60, lMin: 50, lMax: 80, hRange: [20, 50] }, corporate: { sMin: 10, sMax: 40, lMin: 20, lMax: 50, hRange: [200, 240] },
                        luxury: { sMin: 20, sMax: 60, lMin: 10, lMax: 40, hRange: [30, 60] }, wedding: { sMin: 10, sMax: 40, lMin: 40, lMax: 98 }, 
                        grayscale: { sMin: 0, sMax: 0, lMin: 10, lMax: 90 }, cyberpunk: { sMin: 80, sMax: 100, lMin: 40, lMax: 70 },
                        minimal: { sMin: 0, sMax: 20, lMin: 80, lMax: 98 }, summer: { sMin: 60, sMax: 90, lMin: 50, lMax: 80, hRange: [0, 60] },
                        forest: { sMin: 30, sMax: 70, lMin: 20, lMax: 50, hRange: [80, 160] }, sunset: { sMin: 50, sMax: 90, lMin: 40, lMax: 70, hRange: [260, 360] },
                        tech: { sMin: 50, sMax: 90, lMin: 40, lMax: 80, hRange: [180, 240] }, berry: { sMin: 40, sMax: 80, lMin: 30, lMax: 60, hRange: [280, 340] },
                        coffee: { sMin: 20, sMax: 50, lMin: 20, lMax: 60, hRange: [20, 40] }, spring: { sMin: 40, sMax: 70, lMin: 70, lMax: 90, hRange: [60, 150] },
                        autumn: { sMin: 50, sMax: 90, lMin: 30, lMax: 60, hRange: [0, 60] }, winter: { sMin: 10, sMax: 40, lMin: 80, lMax: 95, hRange: [180, 240] },
                        kids: { sMin: 80, sMax: 100, lMin: 50, lMax: 70 }, pop: { sMin: 70, sMax: 100, lMin: 50, lMax: 60 }, candy: { sMin: 50, sMax: 80, lMin: 70, lMax: 90 },
                        none: { sMin: 20, sMax: 95, lMin: 10, lMax: 90 }
                    };
                    return sets[App.state.preset] || sets.none;
                },
                toggleLock: (idx) => { if(idx >= App.state.mode) return; App.state.locked[idx] = !App.state.locked[idx]; App.ui.render(); },
                saveState: () => {
                    const snap = JSON.stringify({ colors: App.state.colors, mode: App.state.mode, locked: App.state.locked });
                    if(App.state.undoStack.length === 0 || JSON.stringify(App.state.undoStack[App.state.undoStack.length-1]) !== snap) {
                        App.state.undoStack.push(JSON.parse(snap)); if(App.state.undoStack.length > 20) App.state.undoStack.shift();
                    } App.state.redoStack = [];
                },
                undo: () => {
                    if(App.state.undoStack.length === 0) return;
                    App.state.redoStack.push({ colors: App.state.colors, mode: App.state.mode, locked: App.state.locked });
                    const prev = App.state.undoStack.pop();
                    App.state.colors = prev.colors; App.state.mode = prev.mode; App.state.locked = prev.locked;
                    App.logic.setMode(prev.mode, false); 
                },
                redo: () => {
                    if(App.state.redoStack.length === 0) return;
                    App.logic.saveState();
                    const next = App.state.redoStack.pop();
                    App.state.colors = next.colors; App.state.mode = next.mode; App.state.locked = next.locked;
                    App.logic.setMode(next.mode, false); 
                },
                savePalette: () => {
                    App.state.library.unshift({ colors: App.state.colors.map(c => c.hex), date: new Date().toLocaleDateString() });
                    localStorage.setItem('chromazen_library', JSON.stringify(App.state.library));
                    App.ui.switchSidebarTab('library'); App.ui.renderLibrary();
                    App.ui.showToast('ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì €ìž¥ë˜ì—ˆìŠµë‹ˆë‹¤.'); 
                },
                deleteSaved: (idx) => {
                    App.state.library.splice(idx, 1); localStorage.setItem('chromazen_library', JSON.stringify(App.state.library)); App.ui.renderLibrary();
                },
                loadSaved: (idx) => {
                    App.logic.saveState();
                    const saved = App.state.library[idx];
                    App.state.colors = saved.colors.map(hex => App.utils.hexToHsl(hex));
                    App.logic.setMode(saved.colors.length, false); 
                },
                extractFromImage: (file) => {
                    if(!file) return;
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
                            const w = 150, h = 150 * (img.height/img.width); canvas.width = w; canvas.height = h;
                            ctx.drawImage(img, 0, 0, w, h);
                            const data = ctx.getImageData(0,0,w,h).data;
                            const colors = []; 
                            const threshold = 60; 
                            for(let i=0; i<1000; i++) { 
                                const offset = Math.floor(Math.random() * (data.length / 4)) * 4;
                                const r=data[offset], g=data[offset+1], b=data[offset+2];
                                const currentRgb = {r, g, b};
                                let distinct = true;
                                for(let c of colors) {
                                    if(App.utils.getColorDistance(currentRgb, c.rgb) < threshold) { distinct = false; break; }
                                }
                                if(distinct) {
                                    const hex = "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
                                    colors.push({ ...App.utils.hexToHsl(hex), rgb: currentRgb });
                                    if(colors.length >= App.state.mode) break;
                                }
                            }
                            const finalColors = colors.map(c => ({h:c.h, s:c.s, l:c.l, hex:c.hex}));
                            App.logic.saveState();
                            App.state.colors = finalColors;
                            while(App.state.colors.length < App.state.mode) App.state.colors.push(App.logic.getRandomColor());
                            App.ui.render(); App.ui.addToHistory(); App.ui.showToast('ì´ë¯¸ì§€ì—ì„œ ìƒ‰ìƒì„ ì¶”ì¶œí–ˆìŠµë‹ˆë‹¤.');
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                },
                clearHistory: () => { 
                    App.state.history = [];
                    localStorage.removeItem('chromazen_history');
                    if(App.state.activeTab === 'history') { App.ui.renderHistory(); } 
                    else { App.ui.showToast("ížˆìŠ¤í† ë¦¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."); }
                },
                handleDragStart: (e, idx) => {
                    e.dataTransfer.setData('text/plain', idx);
                    e.dataTransfer.effectAllowed = 'move';
                    e.target.classList.add('panel-dragging');
                },
                handleDrop: (e, toIndex) => {
                    e.preventDefault();
                    const fromIndex = parseInt(e.dataTransfer.getData('text/plain'));
                    if (fromIndex === toIndex) return;
                    App.logic.saveState();
                    const cols = [...App.state.colors];
                    const locks = [...App.state.locked];
                    const movedCol = cols.splice(fromIndex, 1)[0];
                    const movedLock = locks.splice(fromIndex, 1)[0];
                    cols.splice(toIndex, 0, movedCol);
                    locks.splice(toIndex, 0, movedLock);
                    App.state.colors = cols; App.state.locked = locks; App.ui.render();
                },
                adjustShade: (idx, amount) => {
                    App.logic.saveState();
                    const c = App.state.colors[idx];
                    c.l = Math.max(0, Math.min(100, c.l + amount));
                    c.hex = App.utils.hslToHex(c.h, c.s, c.l);
                    App.ui.render();
                }
            },
            ui: {
                // ADDED: Missing addToHistory method causing the TypeError
                addToHistory: () => {
                    if (!App.state.colors || App.state.colors.length === 0) return;
                    // Guard against null colors
                    const validColors = App.state.colors.filter(c => c && c.hex);
                    if (validColors.length !== App.state.colors.length) return;

                    const snap = validColors.map(c => c.hex);
                    App.state.history.unshift(snap);
                    if(App.state.history.length > 20) App.state.history.pop();
                    
                    // Save history to localStorage
                    localStorage.setItem('chromazen_history', JSON.stringify(App.state.history));

                    if(App.state.activeTab === 'history') App.ui.renderHistory();
                },
                // ADDED: Missing renderHistory method
                renderHistory: () => {
                    const container = document.getElementById('history-container'); container.innerHTML = '';
                    if(App.state.history.length === 0) { container.innerHTML = '<p class="text-xs text-gray-400 col-span-4 text-center mt-4">ížˆìŠ¤í† ë¦¬ê°€ ë¹„ì–´ìžˆìŠµë‹ˆë‹¤.</p>'; return; }
                    App.state.history.forEach(palette => {
                        const div = document.createElement('div');
                        div.className = 'w-full aspect-square rounded-lg overflow-hidden cursor-pointer hover:ring-2 ring-indigo-500 transition-all flex flex-col border dark:border-gray-700';
                        div.onclick = () => { App.logic.saveState(); App.state.colors = palette.map(hex => App.utils.hexToHsl(hex)); App.logic.setMode(palette.length, false); };
                        palette.forEach(hex => { const d = document.createElement('div'); d.style.backgroundColor = hex; d.className = 'flex-1 w-full'; div.appendChild(d); });
                        container.appendChild(div);
                    });
                },
                setViewMode: (mode) => {
                    App.state.viewMode = mode;
                    document.querySelectorAll('.view-btn').forEach(b => {
                        b.classList.remove('bg-white','dark:bg-dark-surface','text-gray-900','dark:text-white','shadow-sm');
                        b.classList.add('text-gray-500','dark:text-gray-400');
                    });
                    document.getElementById(`view-${mode}`).classList.add('bg-white','dark:bg-dark-surface','text-gray-900','dark:text-white','shadow-sm');
                    document.getElementById(`view-${mode}`).classList.remove('text-gray-500','dark:text-gray-400');
                    ['palette','gradient','mockup','typography'].forEach(v => {
                        const el = document.getElementById(`view-${v}-content`);
                        if(v === mode) el.classList.remove('hidden'); else el.classList.add('hidden');
                    });
                    if(mode === 'mockup') App.ui.setMockupScene(App.state.mockupScene);
                    if(mode === 'typography') App.ui.setTypoStyle(App.state.typoStyle);
                    App.ui.render();
                },
                toggleSidebar: () => {
                    App.state.sidebarOpen = !App.state.sidebarOpen;
                    const sb = document.getElementById('sidebar');
                    if(App.state.sidebarOpen) sb.classList.remove('sidebar-closed'); else sb.classList.add('sidebar-closed');
                },
                toggleSound: () => {
                    App.state.soundEnabled = !App.state.soundEnabled;
                    const btn = document.getElementById('btn-sound');
                    btn.innerHTML = App.state.soundEnabled 
                        ? '<i data-lucide="volume-2" class="w-5 h-5"></i>' 
                        : '<i data-lucide="volume-x" class="w-5 h-5"></i>';
                    if(window.lucide) lucide.createIcons();
                    App.ui.showToast(App.state.soundEnabled ? 'ì‚¬ìš´ë“œ ì¼œì§' : 'ì‚¬ìš´ë“œ êº¼ì§');
                },
                toggleGrayscale: () => {
                    App.state.grayscaleMode = !App.state.grayscaleMode;
                    const main = document.getElementById('app-main');
                    if (App.state.grayscaleMode) main.classList.add('grayscale'); else main.classList.remove('grayscale');
                    const btn = document.getElementById('btn-grayscale');
                    btn.innerHTML = App.state.grayscaleMode ? '<i data-lucide="eye-off" class="w-5 h-5 text-blue-500"></i>' : '<i data-lucide="eye" class="w-5 h-5"></i>';
                    if(window.lucide) lucide.createIcons();
                    App.ui.showToast(App.state.grayscaleMode ? 'í‘ë°± ëª¨ë“œ ì¼œì§' : 'í‘ë°± ëª¨ë“œ êº¼ì§');
                },
                render: () => {
                    const mode = App.state.viewMode;
                    if(mode === 'palette') App.ui.renderPalette();
                    if(mode === 'gradient') App.ui.renderGradient();
                    if(mode === 'mockup') App.ui.renderMockup();
                    if(mode === 'typography') App.ui.renderTypography();
                    App.ui.updateRemixButtons();
                    if(window.lucide) lucide.createIcons();
                    App.utils.updateHash();
                },
                updateRemixButtons: () => {
                    const c = App.state.colors; if(!c.length) return;
                    const bg = c[0].hex, txt = App.utils.getTextColor(bg), border = c[1] ? c[1].hex : bg;
                    const styleBtn = (btn) => { if(!btn) return; btn.style.backgroundColor = bg; btn.style.color = txt; btn.style.borderColor = border; };
                    styleBtn(document.getElementById('btn-remix-mockup'));
                    styleBtn(document.getElementById('btn-remix-typo'));
                },
                renderPalette: () => {
                    const container = document.getElementById('view-palette-content'); container.innerHTML = '';
                    App.state.colors.forEach((c, i) => {
                        if (!c) return; // Guard against null colors
                        const txt = App.utils.getTextColor(c.hex); const isLocked = App.state.locked[i];
                        const name = App.utils.getColorName(c.hex);
                        const nextColor = App.state.colors[i+1];
                        const contrastBadge = nextColor ? App.utils.getContrastBadge(App.utils.getContrast(c.hex, nextColor.hex)) : '';
                        const div = document.createElement('div');
                        div.draggable = true;
                        div.className = `color-panel flex-1 relative flex flex-col justify-center items-center group cursor-pointer p-4 ${isLocked?'panel-locked':''}`;
                        div.style.backgroundColor = c.hex; div.style.color = txt;
                        div.ondragstart = (e) => App.logic.handleDragStart(e, i);
                        div.ondragover = (e) => e.preventDefault();
                        div.ondrop = (e) => App.logic.handleDrop(e, i);
                        div.ondragend = (e) => e.target.classList.remove('panel-dragging');
                        div.innerHTML = `
                            <div class="absolute top-6 right-6"><button onclick="event.stopPropagation(); App.logic.toggleLock(${i})" class="p-2 rounded-full transition-all ${isLocked ? 'bg-black/20 text-white' : 'opacity-0 group-hover:opacity-100 hover:bg-black/10'}"><i data-lucide="${isLocked?'lock':'unlock'}" class="w-5 h-5"></i></button></div>
                            <h2 onclick="event.stopPropagation(); App.ui.openTuneModal(${i})" class="text-3xl font-black uppercase font-mono hover:opacity-70 transition-opacity" title="Edit">${c.hex}</h2>
                            <p class="text-xs opacity-60 font-medium tracking-widest mt-1 text-center">${name}</p>
                            <div class="flex items-center justify-center mt-6 opacity-0 group-hover:opacity-100 transition-opacity w-32 bg-black/10 backdrop-blur-sm rounded-full p-1">
                                <button onclick="event.stopPropagation(); App.logic.adjustShade(${i}, 5)" class="flex-1 py-1 rounded-l-full hover:bg-white/20 flex justify-center" title="Lighter"><i data-lucide="plus" class="w-4 h-4"></i></button>
                                <div class="w-px h-4 bg-white/20"></div>
                                <button onclick="event.stopPropagation(); App.logic.adjustShade(${i}, -5)" class="flex-1 py-1 rounded-r-full hover:bg-white/20 flex justify-center" title="Darker"><i data-lucide="minus" class="w-4 h-4"></i></button>
                            </div>
                            <button onclick="event.stopPropagation(); App.utils.copy('${c.hex}')" class="absolute bottom-10 opacity-0 group-hover:opacity-100 transition-opacity px-4 py-2 rounded-full border border-current bg-white/10 backdrop-blur-sm text-xs font-bold flex items-center gap-2"><i data-lucide="copy" class="w-3 h-3"></i> COPY</button>
                            ${contrastBadge}
                        `;
                        container.appendChild(div);
                    });
                },
                renderGradient: () => {
                    const angle = App.state.gradientAngle || 90;
                    const css = `linear-gradient(${angle}deg, ${App.state.colors.filter(c=>c).map(c=>c.hex).join(', ')})`;
                    document.getElementById('gradient-box').style.background = css;
                    document.getElementById('gradient-css').innerText = css;
                },
                updateGradientAngle: (val) => {
                    App.state.gradientAngle = val; document.getElementById('grad-angle-val').innerText = val + 'Â°'; App.ui.renderGradient();
                },
                setMockupScene: (scene) => {
                    App.state.mockupScene = scene;
                    document.querySelectorAll('.mockup-scene-btn').forEach(b => {
                        b.className = 'mockup-scene-btn px-3 py-1.5 text-xs font-bold rounded-md hover:bg-gray-100 dark:hover:bg-dark-bg text-gray-500';
                        if(b.innerText.toLowerCase().includes(scene) || (scene === 'app' && b.innerText === 'App') || (scene === 'dashboard' && b.innerText === 'Dash')) {
                            b.className = 'mockup-scene-btn px-3 py-1.5 text-xs font-bold rounded-md bg-black text-white dark:bg-white dark:text-black';
                        }
                    });
                    App.ui.renderMockup();
                },
                renderMockup: () => {
                    const rawColors = App.state.colors;
                    const offset = App.state.colorOffset;
                    const c = rawColors.map((_, i) => rawColors[(i + offset) % rawColors.length]);
                    const container = document.getElementById('mockup-inject-area');
                    const bg = c[0].hex, txt = App.utils.getTextColor(bg), acc = c[1] ? c[1].hex : bg;
                    const scene = App.state.mockupScene;

                    let html = '';
                    if (scene === 'landing') {
                        html = `
                        <div class="grid grid-cols-1 md:grid-cols-12 gap-6 min-h-[800px] rounded-3xl overflow-hidden shadow-2xl transition-colors" style="background:${bg}">
                            <div class="md:col-span-12 p-12 md:p-16 flex flex-col md:flex-row items-center justify-between relative overflow-hidden" style="background:${bg}; color:${txt}">
                                <div class="relative z-10 max-w-lg space-y-6">
                                    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-widest backdrop-blur-sm" style="background:${txt}15; color:${txt}">New Arrival</div>
                                    <h1 class="text-6xl md:text-8xl font-black tracking-tighter leading-[0.9]" style="background:linear-gradient(to right, ${txt}, ${acc}); -webkit-background-clip:text; -webkit-text-fill-color:transparent;">MAKE<br>WAVES.</h1>
                                    <p class="text-lg opacity-80 max-w-sm font-medium">Experience the next generation of creative tools.</p>
                                    <div class="flex gap-4 pt-4">
                                        <button class="px-8 py-4 rounded-full font-bold shadow-lg hover:scale-105 transition-transform" style="background:${acc}; color:${App.utils.getTextColor(acc)}">Get Started</button>
                                        <button class="px-8 py-4 rounded-full font-bold border-2 transition-colors" style="border-color:${txt}40; color:${txt}">Learn More</button>
                                    </div>
                                </div>
                                <div class="absolute right-0 top-0 w-full h-full md:w-1/2 opacity-30 pointer-events-none"><svg viewBox="0 0 400 400" fill="none" style="transform: rotate(-15deg);"><circle cx="300" cy="100" r="80" fill="${c[2]?.hex || acc}" fill-opacity="0.2" /><rect x="200" y="200" width="120" height="120" rx="20" fill="${c[3]?.hex || bg}" fill-opacity="0.2" /></svg></div>
                            </div>
                            <div class="md:col-span-4 p-10 rounded-3xl flex flex-col justify-between" style="background:${txt}08; backdrop-filter: blur(12px); border: 1px solid ${txt}10; color:${txt}">
                                <div class="w-12 h-12 rounded-full flex items-center justify-center bg-black/10 mb-6"><i data-lucide="zap" class="w-6 h-6"></i></div>
                                <div><h3 class="text-2xl font-bold mb-2">Fast</h3><p class="opacity-70 text-sm">Lightning quick color generation.</p></div>
                            </div>
                            <div class="md:col-span-4 p-10 rounded-3xl flex flex-col justify-between border-2 border-dashed" style="background:${txt}08; backdrop-filter: blur(12px); border-color:${txt}20; color:${txt}">
                                <div class="w-full h-24 flex items-end gap-2 mb-6 opacity-50"><div class="w-1/4 h-1/2 bg-current rounded-t-lg"></div><div class="w-1/4 h-3/4 bg-current rounded-t-lg"></div><div class="w-1/4 h-full bg-current rounded-t-lg"></div><div class="w-1/4 h-2/3 bg-current rounded-t-lg"></div></div>
                                <div><h3 class="text-2xl font-bold mb-2">Analytics</h3><p class="opacity-70 text-sm">Data driven decisions.</p></div>
                            </div>
                            <div class="md:col-span-4 p-10 rounded-3xl flex flex-col justify-center items-center text-center relative overflow-hidden" style="background:linear-gradient(135deg, ${c[2]?.hex}, ${c[3]?.hex}); color:${App.utils.getTextColor(c[2]?.hex)}">
                                <div class="absolute inset-0 opacity-20 bg-gradient-to-tr from-transparent to-black"></div><h3 class="text-3xl font-black relative z-10">PRO<br>MODE</h3>
                            </div>
                        </div>`;
                    } else if (scene === 'app') {
                        const cardBg = App.utils.getContrast(bg, '#ffffff') > 1.2 ? '#ffffff' : '#000000';
                        html = `
                        <div class="flex justify-center items-center min-h-[700px]" style="background:${c[2]?.hex}20">
                            <div class="w-[375px] h-[750px] rounded-[40px] shadow-2xl overflow-hidden relative flex flex-col border-8 border-gray-900" style="background:${bg}; color:${txt}">
                                <div class="h-14 flex items-center justify-between px-6 shrink-0"><i data-lucide="menu" class="w-6 h-6"></i><span class="font-bold">App</span><div class="w-8 h-8 rounded-full bg-current opacity-20"></div></div>
                                <div class="p-6 space-y-6 flex-1 overflow-y-auto scrollbar-thin">
                                    <div class="p-6 rounded-2xl" style="background:${acc}; color:${App.utils.getTextColor(acc)}">
                                        <p class="opacity-70 text-xs font-bold uppercase mb-1">Balance</p><h2 class="text-3xl font-bold">$12,450</h2>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="aspect-square rounded-2xl flex flex-col justify-center items-center gap-2" style="background:${c[2]?.hex}; color:${App.utils.getTextColor(c[2]?.hex)}"><i data-lucide="send" class="w-6 h-6"></i><span class="text-sm font-bold">Send</span></div>
                                        <div class="aspect-square rounded-2xl flex flex-col justify-center items-center gap-2" style="background:${c[3]?.hex}; color:${App.utils.getTextColor(c[3]?.hex)}"><i data-lucide="download" class="w-6 h-6"></i><span class="text-sm font-bold">Receive</span></div>
                                    </div>
                                    <div class="space-y-3">
                                        <h3 class="font-bold text-sm opacity-50 uppercase">Recent</h3>
                                        ${[1,2,3].map(i => `<div class="flex items-center gap-4 p-4 rounded-xl" style="background:${txt}08"><div class="w-10 h-10 rounded-full flex items-center justify-center font-bold" style="background:${c[i]?.hex || acc}; color:${App.utils.getTextColor(c[i]?.hex || acc)}">${i}</div><div class="flex-1"><div class="h-2 w-20 bg-current opacity-20 rounded mb-1"></div><div class="h-2 w-12 bg-current opacity-10 rounded"></div></div></div>`).join('')}
                                    </div>
                                </div>
                                <div class="h-16 flex items-center justify-around px-2 border-t" style="border-color:${txt}10"><i data-lucide="home" class="w-6 h-6 opacity-100"></i><i data-lucide="search" class="w-6 h-6 opacity-40"></i><i data-lucide="heart" class="w-6 h-6 opacity-40"></i><i data-lucide="user" class="w-6 h-6 opacity-40"></i></div>
                            </div>
                        </div>`;
                    } else if (scene === 'dashboard') {
                        html = `
                        <div class="w-full min-h-[700px] p-8 rounded-xl shadow-inner grid grid-cols-4 gap-6" style="background:${bg}; color:${txt}">
                            <div class="col-span-1 p-6 rounded-xl flex flex-col gap-6" style="background:${txt}05">
                                <div class="font-bold text-xl flex items-center gap-2"><div class="w-6 h-6 rounded bg-gradient-to-tr from-${acc} to-${c[2]?.hex}"></div> Dash.</div>
                                <div class="space-y-2 text-sm font-medium opacity-70">
                                    <div class="p-2 rounded bg-current text-[${bg}]">Overview</div><div class="p-2">Analytics</div><div class="p-2">Settings</div>
                                </div>
                            </div>
                            <div class="col-span-3 grid grid-cols-3 gap-6">
                                <div class="col-span-3 p-8 rounded-xl flex items-end justify-between" style="background:${txt}05; height: 300px">
                                    ${[40, 70, 50, 90, 60, 80, 45, 75].map((h, i) => `<div class="w-full mx-2 rounded-t-lg transition-all hover:opacity-80" style="height:${h}%; background:${i%2===0 ? acc : c[2]?.hex || acc}"></div>`).join('')}
                                </div>
                                <div class="col-span-1 p-6 rounded-xl" style="background:${c[3]?.hex || acc}; color:${App.utils.getTextColor(c[3]?.hex || acc)}">
                                    <h3 class="text-sm font-bold opacity-70 mb-2">Total Users</h3><p class="text-4xl font-bold">24k</p>
                                </div>
                                <div class="col-span-1 p-6 rounded-xl" style="background:${c[2]?.hex || acc}; color:${App.utils.getTextColor(c[2]?.hex || acc)}">
                                    <h3 class="text-sm font-bold opacity-70 mb-2">Revenue</h3><p class="text-4xl font-bold">$1.2M</p>
                                </div>
                                <div class="col-span-1 p-6 rounded-xl border-2 border-dashed flex items-center justify-center opacity-50" style="border-color:${txt}40">
                                    <span>Add Widget</span>
                                </div>
                            </div>
                        </div>`;
                    } else if (scene === 'art') {
                        html = `
                        <div class="w-full min-h-[700px] rounded-xl overflow-hidden relative flex items-center justify-center" style="background:${bg}">
                            <div class="absolute inset-0 opacity-50 mix-blend-multiply" style="background: radial-gradient(circle at 20% 30%, ${c[1]?.hex}, transparent 50%), radial-gradient(circle at 80% 70%, ${c[2]?.hex}, transparent 50%);"></div>
                            <div class="relative z-10 text-center mix-blend-difference" style="color:${c[4]?.hex || '#fff'}">
                                <h1 class="text-9xl font-black tracking-tighter leading-none mb-4">ART<br>IS<br>CHAOS</h1>
                                <p class="text-2xl font-serif italic tracking-widest">Find your color.</p>
                            </div>
                            <div class="absolute w-64 h-64 rounded-full blur-3xl top-1/4 left-1/4 animate-pulse" style="background:${acc}"></div>
                            <div class="absolute w-96 h-96 rounded-full blur-3xl bottom-1/4 right-1/4 animate-pulse" style="background:${c[3]?.hex}" style="animation-delay:1s"></div>
                        </div>`;
                    }
                    container.innerHTML = html;
                    if(window.lucide) lucide.createIcons();
                },
                setTypoStyle: (style) => {
                    App.state.typoStyle = style;
                    document.querySelectorAll('.typo-style-btn').forEach(b => {
                        b.className = 'typo-style-btn px-3 py-1.5 text-xs font-bold rounded-md hover:bg-gray-100 dark:hover:bg-dark-bg text-gray-500';
                        if(b.innerText.toLowerCase() === style) {
                            b.className = 'typo-style-btn px-3 py-1.5 text-xs font-bold rounded-md bg-black text-white dark:bg-white dark:text-black';
                        }
                    });
                    App.ui.renderTypography();
                },
                renderTypography: () => {
                    const rawColors = App.state.colors;
                    const offset = App.state.colorOffset;
                    const c = rawColors.map((_, i) => rawColors[(i + offset) % rawColors.length]);
                    const container = document.getElementById('typo-inject-area');
                    const getColor = (i) => c[i % c.length].hex;
                    const style = App.state.typoStyle;

                    let html = '';
                    if (style === 'modern') {
                        html = `
                        <article class="max-w-3xl mx-auto bg-white dark:bg-dark-surface p-16 rounded-xl shadow-sm" style="font-family: 'Inter', sans-serif;">
                            <div class="flex items-center justify-between border-b-2 pb-8 mb-12" style="border-color:${getColor(0)}">
                                <span class="text-sm font-bold tracking-[0.2em] uppercase" style="color:${getColor(2)}">Brand Guideline</span>
                                <span class="text-sm font-mono opacity-60" style="color:${getColor(0)}">v1.0</span>
                            </div>
                            <h1 class="text-7xl font-black mb-8 leading-tight" style="color:${getColor(0)}">Visual<br>Harmony.</h1>
                            <p class="text-2xl font-medium leading-relaxed mb-6" style="color:${getColor(1)}">Color creates emotion. It is the silent ambassador of your brand.</p>
                            <div class="p-10 rounded-xl mb-12" style="background:${getColor(4)}; color:${App.utils.getTextColor(getColor(4))}">
                                <h3 class="text-2xl font-bold mb-4">"Design is intelligence made visible."</h3>
                            </div>
                        </article>`;
                    } else if (style === 'editorial') {
                        html = `
                        <article class="max-w-4xl mx-auto p-16 rounded-xl shadow-sm" style="background:${getColor(0)}; color:${App.utils.getTextColor(getColor(0))}; font-family: 'Playfair Display', serif;">
                            <div class="text-center mb-16"><span class="italic text-lg border-b border-current pb-1">The Collection</span></div>
                            <h1 class="text-8xl font-black mb-12 text-center leading-none tracking-tight font-abril" style="color:${getColor(2)}">ELEGANCE<br>& GRACE</h1>
                            <div class="columns-2 gap-8 text-lg leading-loose opacity-80" style="column-rule: 1px solid ${getColor(2)}40">
                                <p class="mb-4"><span class="text-4xl float-left mr-2 font-bold" style="color:${getColor(1)}">T</span>rue elegance is not about being noticed, it's about being remembered. In the world of design, typography and color serve as the primary vehicles of expression.</p>
                                <p>By carefully selecting a palette that whispers rather than shouts, we create an atmosphere of timeless sophistication.</p>
                            </div>
                        </article>`;
                    } else if (style === 'sns') {
                        html = `
                        <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Story Format -->
                            <div class="aspect-[9/16] rounded-2xl relative p-8 flex flex-col justify-between" style="background:${getColor(0)}; color:${App.utils.getTextColor(getColor(0))}">
                                <div class="flex gap-2 opacity-50"><div class="flex-1 h-1 bg-current rounded-full"></div><div class="flex-1 h-1 bg-current rounded-full opacity-50"></div></div>
                                <div>
                                    <h2 class="text-5xl font-black mb-4 leading-tight">NEW<br>DROP<br>TODAY</h2>
                                    <p class="text-lg font-medium opacity-80">Check out our latest collection in store now.</p>
                                </div>
                                <button class="w-full py-4 rounded-full font-bold text-center" style="background:${getColor(2)}; color:${App.utils.getTextColor(getColor(2))}">Swipe Up</button>
                            </div>
                            <!-- Feed Post Format -->
                            <div class="aspect-square rounded-2xl p-8 flex flex-col justify-center items-center text-center relative" style="background:${getColor(1)}; color:${App.utils.getTextColor(getColor(1))}">
                                <div class="absolute inset-4 border-2 opacity-30" style="border-color:currentColor"></div>
                                <span class="text-xs font-bold tracking-[0.3em] uppercase mb-4 opacity-70">Quote of the Day</span>
                                <h3 class="text-3xl font-serif italic leading-relaxed">"Colors are the smiles of nature."</h3>
                                <div class="mt-6 flex items-center gap-2 text-sm font-bold"><div class="w-6 h-6 rounded-full bg-current"></div> @chromazen</div>
                            </div>
                        </div>`;
                    } else if (style === 'poster') {
                        html = `
                        <div class="max-w-3xl mx-auto p-12 rounded-none shadow-none flex flex-col justify-between min-h-[800px] border-8" style="background:${getColor(0)}; border-color:${getColor(1)}; color:${App.utils.getTextColor(getColor(0))}">
                            <div class="flex justify-between font-bold text-xl uppercase tracking-widest border-b-4 pb-4" style="border-color:${getColor(1)}"><span>01</span><span>Manifesto</span></div>
                            <h1 class="text-[120px] font-black leading-[0.8] my-auto break-all" style="color:${getColor(2)}; -webkit-text-stroke: 2px ${getColor(1)}">BOLD<br>MOVES<br>ONLY.</h1>
                            <div class="bg-black text-white p-6 font-mono text-sm" style="background:${getColor(1)}; color:${App.utils.getTextColor(getColor(1))}">
                                FIG. 1 â€” THE POWER OF COLOR.<br>EXPLORE UNCHARTED TERRITORIES OF CREATIVITY.
                            </div>
                        </div>`;
                    }
                    container.innerHTML = html;
                },
                initHarmonyDropdown: () => {
                    const dd = document.getElementById('harmony-items');
                    const opts = [
                        {v:'random', t:'ðŸŽ² Random Shuffle', i:'ì™„ì „ ë¬´ìž‘ìœ„ ë°°ìƒ‰'}, {v:'analogous', t:'ðŸŽ¨ Analogous', i:'ìœ ì‚¬ìƒ‰: ì¸ì ‘í•œ ìƒ‰ìƒë“¤ì˜ ì¡°í™”'},
                        {v:'monochromatic', t:'ðŸŒ— Monochromatic', i:'ë‹¨ìƒ‰: ëª…ë„ ì°¨ì´ë¥¼ ì´ìš©í•œ í†¤ì˜¨í†¤'}, {v:'complementary', t:'â˜¯ï¸ Complementary', i:'ë³´ìƒ‰: ì„œë¡œ ë°˜ëŒ€ë˜ëŠ” ê°•ë ¬í•œ ëŒ€ë¹„'},
                        {v:'triadic', t:'ðŸ”º Triadic', i:'ì‚¼ê°ì¡°í™”: ê· í˜• ìž¡ížŒ 3ìƒ‰ ë°°í•©'}
                    ];
                    dd.innerHTML = opts.map(o => `<div onclick="App.logic.selectHarmony('${o.v}', '${o.t}')" onmouseenter="App.ui.updateInfo('${o.i}')" onmouseleave="App.ui.resetInfo()">${o.t}</div>`).join('');
                },
                toggleDropdown: (e) => {
                    e.stopPropagation();
                    const el = document.getElementById('harmony-items');
                    el.style.display = el.style.display === 'block' ? 'none' : 'block';
                    document.querySelector('.select-selected i').classList.toggle('select-arrow-active');
                },
                toggleHelpSection: (id) => {
                    const el = document.getElementById(id);
                    const isHidden = el.classList.contains('hidden');
                    document.querySelectorAll('.help-section-content').forEach(d => d.classList.add('hidden'));
                    document.querySelectorAll('.help-arrow').forEach(a => a.style.transform = 'rotate(0deg)');
                    if(isHidden) {
                        el.classList.remove('hidden');
                        document.getElementById('arrow-'+id).style.transform = 'rotate(180deg)';
                    }
                },
                toggleHelpLang: () => {
                    App.state.helpLang = App.state.helpLang === 'ko' ? 'en' : 'ko';
                    App.ui.showHelp(App.state.lastHelpTab);
                },
                // New Function to refresh inspiration card only
                updateInspirationCard: () => {
                    const isKo = App.state.helpLang === 'ko';
                    const dailyTips = isKo ? [
                        "íŒŒëž€ìƒ‰ì€ ì‹ìš•ì„ ì–µì œí•©ë‹ˆë‹¤. ì‹í’ˆ ê´€ë ¨ ë¸Œëžœë“œë¼ë©´ ì£¼ì˜í•˜ì„¸ìš”!",
                        "ê°€ìž¥ ì•ˆì „í•œ í…ìŠ¤íŠ¸ ìƒ‰ìƒì€ #000ì´ ì•„ë‹ˆë¼ #333 ìž…ë‹ˆë‹¤.",
                        "ìžì—°ì˜ ìƒ‰ì€ ê²°ì½” ì¶©ëŒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìˆ²ê³¼ ë°”ë‹¤ ì‚¬ì§„ì—ì„œ ì˜ê°ì„ ì–»ìœ¼ì„¸ìš”.",
                        "CTA ë²„íŠ¼ì€ íŽ˜ì´ì§€ì—ì„œ ê°€ìž¥ íŠ€ëŠ” 'ê°•ì¡°ìƒ‰'ì„ ì‚¬ìš©í•´ì•¼ í´ë¦­ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.",
                        "íšŒìƒ‰ì— ì•„ì£¼ ì•½ê°„ì˜ íŒŒëž€ìƒ‰ì„ ì„žìœ¼ë©´ í›¨ì”¬ ì„¸ë ¨ëœ ì¿¨ ê·¸ë ˆì´ê°€ ë©ë‹ˆë‹¤.",
                        "ë…¸ëž€ìƒ‰ì€ ê²€ì • ë°°ê²½ ìœ„ì—ì„œ ê°€ìž¥ ê°€ë…ì„±ì´ ë†’ìŠµë‹ˆë‹¤.",
                        "ì—¬ë°±(White Space)ì€ ë””ìžì¸ì—ì„œ ê°€ìž¥ ì¤‘ìš”í•œ 'ìƒ‰ìƒ'ìž…ë‹ˆë‹¤."
                    ] : [
                        "Blue suppresses appetite. Be careful with food branding!",
                        "The safest text color is not #000, but #333.",
                        "Nature's colors never clash. Look at forests and oceans for inspiration.",
                        "Use your 'Accent Color' for CTA buttons to maximize click-through rates.",
                        "Adding a tiny bit of blue to grey makes it look more premium.",
                        "Yellow offers the highest readability against a black background.",
                        "White space is the most important 'color' in design."
                    ];
                    const randomTip = dailyTips[Math.floor(Math.random() * dailyTips.length)];
                    const card = document.getElementById('daily-inspiration-card');
                    const text = document.getElementById('daily-inspiration-text');
                    
                    // Simple animation reset
                    card.classList.remove('animate-pulse-fast');
                    void card.offsetWidth; // Trigger reflow
                    card.classList.add('animate-pulse-fast');
                    
                    text.innerText = `"${randomTip}"`;
                    setTimeout(() => card.classList.remove('animate-pulse-fast'), 500);
                },
                showHelp: (initialTab = 'tips') => {
                    App.state.lastHelpTab = initialTab;
                    const isKo = App.state.helpLang === 'ko';
                    
                    const content = `
                        <div class="bg-white dark:bg-dark-surface rounded-2xl shadow-2xl w-full max-w-lg p-6 transform scale-100 transition-transform overflow-hidden relative flex flex-col max-h-[85vh]">
                            <button onclick="App.ui.toggleHelpLang()" class="absolute top-6 right-6 z-10 text-[10px] font-bold border border-gray-200 dark:border-gray-600 rounded px-2 py-1 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors uppercase tracking-widest text-gray-500 dark:text-gray-400">
                                ${isKo ? 'EN' : 'KR'}
                            </button>
                            
                            <!-- Clickable Inspiration Card -->
                            <div id="daily-inspiration-card" onclick="App.ui.updateInspirationCard()" class="mb-4 p-4 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg shrink-0 cursor-pointer hover:shadow-xl hover:scale-[1.02] transition-all active:scale-95 group">
                                <div class="flex justify-between items-center mb-1">
                                    <div class="text-[10px] uppercase font-bold tracking-widest opacity-70">âœ¨ ${isKo?'Today\'s Inspiration':'Today\'s Inspiration'}</div>
                                    <i data-lucide="refresh-cw" class="w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                </div>
                                <p id="daily-inspiration-text" class="text-sm font-medium leading-relaxed">"Click me for a new tip!"</p>
                            </div>

                            <div class="flex border-b border-gray-100 dark:border-dark-border pr-12 shrink-0">
                                <button class="flex-1 py-3 text-sm font-bold border-b-2 ${initialTab==='tips'?'border-black dark:border-white text-black dark:text-white':'border-transparent text-gray-400'}" onclick="App.ui.showHelp('tips')">${isKo ? 'íŒ ê°€ì´ë“œ' : 'Tips & Guide'}</button>
                                <button class="flex-1 py-3 text-sm font-bold border-b-2 ${initialTab==='shortcuts'?'border-black dark:border-white text-black dark:text-white':'border-transparent text-gray-400'}" onclick="App.ui.showHelp('shortcuts')">${isKo ? 'ë‹¨ì¶•í‚¤' : 'Shortcuts'}</button>
                            </div>
                            
                            <div class="p-1 overflow-y-auto scrollbar-thin flex-1 mt-4" id="help-content">
                                ${App.ui.getHelpContent(initialTab, isKo)}
                            </div>
                            
                            <div class="pt-4 border-t border-gray-100 dark:border-dark-border flex justify-end shrink-0">
                                <button onclick="App.ui.closeModal()" class="px-4 py-2 text-sm font-bold bg-black dark:bg-white text-white dark:text-black rounded-lg hover:opacity-80 transition-opacity">${isKo ? 'ë‹«ê¸°' : 'Close'}</button>
                            </div>
                        </div>
                    `;
                    App.ui.showModal(content);
                    // Initialize with a tip
                    App.ui.updateInspirationCard();
                    if(window.lucide) lucide.createIcons();
                },
                getHelpContent: (tab, isKo) => {
                    if(tab === 'shortcuts') {
                        return `
                            <div class="space-y-3 text-sm text-gray-600 dark:text-gray-300 p-2">
                                <div class="flex justify-between items-center py-2 border-b border-gray-50 dark:border-gray-800"><span>${isKo?'ìƒ‰ìƒ ìƒì„±':'Generate'}</span> <span class="font-mono bg-gray-100 dark:bg-dark-bg px-2 py-1 rounded text-xs">Space</span></div>
                                <div class="flex justify-between items-center py-2 border-b border-gray-50 dark:border-gray-800"><span>${isKo?'ìŠ¤ë§ˆíŠ¸ ì…”í”Œ (í†¤ ìœ ì§€)':'Smart Shuffle (Keep Tone)'}</span> <span class="font-mono bg-gray-100 dark:bg-dark-bg px-2 py-1 rounded text-xs">Shift + Click</span></div>
                                <div class="flex justify-between items-center py-2 border-b border-gray-50 dark:border-gray-800"><span>${isKo?'ì‹¤í–‰ ì·¨ì†Œ/ë‹¤ì‹œ ì‹¤í–‰':'Undo / Redo'}</span> <span class="font-mono bg-gray-100 dark:bg-dark-bg px-2 py-1 rounded text-xs">Ctrl + Z / Y</span></div>
                                <div class="flex justify-between items-center py-2 border-b border-gray-50 dark:border-gray-800"><span>${isKo?'ìƒ‰ìƒ ìž ê¸ˆ':'Lock Color'}</span> <span class="font-mono bg-gray-100 dark:bg-dark-bg px-2 py-1 rounded text-xs">1 ... 5</span></div>
                                <div class="flex justify-between items-center py-2"><span>${isKo?'ë‹¨ì¶•í‚¤ ë„ì›€ë§':'Help'}</span> <span class="font-mono bg-gray-100 dark:bg-dark-bg px-2 py-1 rounded text-xs">?</span></div>
                            </div>`;
                    } else {
                        // Extended Tips Content (30+ Tips)
                        const sections = isKo ? [
                            {id:'basic', title:'ðŸ“ ê¸°ë³¸ ë²•ì¹™ (The Basics)', content:`
                                <ul class="list-disc pl-4 space-y-2">
                                    <li><strong>60-30-10 ë²•ì¹™:</strong> 60% ë°°ê²½(ì£¼ì¡°ìƒ‰), 30% ì½˜í…ì¸ (ë³´ì¡°ìƒ‰), 10% í¬ì¸íŠ¸(ê°•ì¡°ìƒ‰) ë¹„ìœ¨ì´ ê°€ìž¥ ì•ˆì •ì ìž…ë‹ˆë‹¤.</li>
                                    <li><strong>ë‹¨ìƒ‰(Monochromatic):</strong> ì‹¤íŒ¨ í™•ë¥  0%. í•œ ê°€ì§€ ìƒ‰ìƒ(Hue)ì˜ ëª…ë„(Lightness)ë§Œ ë‹¤ë¥´ê²Œ ë°°ìƒ‰í•˜ë©´ ê¹”ë”í•˜ê³  ì„¸ë ¨ëœ ëŠë‚Œì„ ì¤ë‹ˆë‹¤.</li>
                                    <li><strong>ìœ ì‚¬ìƒ‰(Analogous):</strong> ìƒ‰ìƒí™˜ì—ì„œ ë°”ë¡œ ì˜†ì— ìžˆëŠ” ìƒ‰ë“¤ì„ ì¡°í•©í•˜ì„¸ìš”. (ì˜ˆ: ì´ˆë¡+ì—°ë‘) ìžì—°ìŠ¤ëŸ½ê³  íŽ¸ì•ˆí•©ë‹ˆë‹¤.</li>
                                    <li><strong>ë³´ìƒ‰(Complementary):</strong> ìƒ‰ìƒí™˜ ë°˜ëŒ€íŽ¸ ìƒ‰ì„ ì‚¬ìš©í•˜ì„¸ìš”. (ì˜ˆ: íŒŒëž‘+ì£¼í™©) ì£¼ëª©ë„ê°€ ë†’ì§€ë§Œ í…ìŠ¤íŠ¸ì—ëŠ” í”¼í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</li>
                                    <li><strong>3ìƒ‰ ì¡°í™”(Triadic):</strong> ìƒ‰ìƒí™˜ì—ì„œ ì •ì‚¼ê°í˜•ì„ ì´ë£¨ëŠ” ì„¸ ê°€ì§€ ìƒ‰. ìƒë™ê° ë„˜ì¹˜ì§€ë§Œ ê· í˜• ìž¡ê¸°ê°€ ì–´ë µìŠµë‹ˆë‹¤.</li>
                                </ul>`},
                            {id:'psy', title:'ðŸ§  ìƒ‰ì±„ ì‹¬ë¦¬í•™ (Psychology)', content:`
                                <ul class="list-disc pl-4 space-y-2">
                                    <li><strong>íŒŒëž‘(Blue):</strong> ì‹ ë¢°, ì•ˆì •, ì „ë¬¸ì„±. ê¸ˆìœµ(ë¹„ìž, ì‚¼ì„±), í…Œí¬(ì¸í…”, ë©”íƒ€), ì˜ë£Œ ë¶„ì•¼ ì„ í˜¸ë„ 1ìœ„.</li>
                                    <li><strong>ë¹¨ê°•(Red):</strong> ì—ë„ˆì§€, ê¸´ë°•í•¨, ì‹ìš• ìžê·¹. 'í• ì¸', 'ë§ˆê° ìž„ë°•', 'ì—ëŸ¬', 'ìœ íŠœë¸Œ/ë„·í”Œë¦­ìŠ¤' ë“± í–‰ë™ ìœ ë„ì— ìµœì .</li>
                                    <li><strong>ì´ˆë¡(Green):</strong> ì„±ìž¥, ê±´ê°•, ëˆ, ì•ˆì •. ëˆˆì´ ê°€ìž¥ íŽ¸ì•ˆí•˜ë©° 'ì„±ê³µ', 'ì•ˆì „' ë©”ì‹œì§€ì— ì í•©í•©ë‹ˆë‹¤.</li>
                                    <li><strong>ë…¸ëž‘(Yellow):</strong> í–‰ë³µ, ê²½ê³ , ì£¼ëª©. ê²€ì • ë°°ê²½ ìœ„ì—ì„œ ê°€ìž¥ ëˆˆì— ìž˜ ë„ëŠ” ìƒ‰ìƒìž…ë‹ˆë‹¤. (ì¹´ì¹´ì˜¤)</li>
                                    <li><strong>ë³´ë¼(Purple):</strong> ì°½ì˜ì„±, ì‹ ë¹„ë¡œì›€, ê³ ê¸‰ìŠ¤ëŸ¬ì›€. ë·°í‹°, íƒ€ë¡œ, í”„ë¦¬ë¯¸ì—„ ì„œë¹„ìŠ¤ì— ì–´ìš¸ë¦½ë‹ˆë‹¤.</li>
                                    <li><strong>ì£¼í™©(Orange):</strong> ì¹œê·¼í•¨, í™œë ¥, ì €ë ´í•¨. ê°€ì„±ë¹„ ì¢‹ì€ ì„œë¹„ìŠ¤ë‚˜ ì»¤ë®¤ë‹ˆí‹°ì— ì í•©í•©ë‹ˆë‹¤.</li>
                                </ul>`},
                            {id:'uiux', title:'ðŸ’» ì‹¤ì „ UI/UX íŒ', content:`
                                <ul class="list-disc pl-4 space-y-2">
                                    <li><strong>ë‹¤í¬ ëª¨ë“œ ë°°ê²½:</strong> #000000(ì™„ì „ ê²€ì •) ëŒ€ì‹  #121212ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. ëˆˆì˜ í”¼ë¡œë¥¼ ì¤„ì´ê³  OLED ìŠ¤ë¯¸ì–´ë§ì„ ë°©ì§€í•©ë‹ˆë‹¤.</li>
                                    <li><strong>ê·¸ë¦¼ìž ìƒ‰ìƒ:</strong> ê²€ì • íˆ¬ëª…ë„(rgba(0,0,0,0.2)) ëŒ€ì‹ , ë¸Œëžœë“œ ì»¬ëŸ¬ì˜ ì•„ì£¼ ì–´ë‘ìš´ í†¤ì„ ì‚¬ìš©í•˜ë©´ í›¨ì”¬ ìƒë™ê° ìžˆìŠµë‹ˆë‹¤.</li>
                                    <li><strong>í…ìŠ¤íŠ¸ ê³„ì¸µ:</strong> í°íŠ¸ í¬ê¸°ë¿ ì•„ë‹ˆë¼ ìƒ‰ìƒì˜ ëª…ë„ë¡œë„ ìœ„ê³„ë¥¼ ë‚˜ëˆ„ì„¸ìš”. (ì˜ˆ: ì œëª© #111, ë³¸ë¬¸ #444, ìº¡ì…˜ #888)</li>
                                    <li><strong>ìˆœìˆ˜ íšŒìƒ‰ í”¼í•˜ê¸°:</strong> íšŒìƒ‰ì—ë„ ì•„ì£¼ ì•½ê°„ì˜ íŒŒëž‘ì´ë‚˜ ë…¸ëž‘ í‹´íŠ¸ë¥¼ ì„žìœ¼ë©´ í›¨ì”¬ ìžì—°ìŠ¤ëŸ¬ì›Œ ë³´ìž…ë‹ˆë‹¤.</li>
                                    <li><strong>ë°°ê²½ìƒ‰:</strong> ì™„ì „í•œ í°ìƒ‰(#FFF)ë³´ë‹¤ ì•„ì£¼ ì—°í•œ ì›œê·¸ë ˆì´(#F9F9F9)ê°€ ëˆˆë¶€ì‹¬ì´ ì ê³  ê³ ê¸‰ìŠ¤ëŸ½ìŠµë‹ˆë‹¤.</li>
                                    <li><strong>ì˜¤ë¥˜ ë©”ì‹œì§€:</strong> ë¹¨ê°•ë§Œ ì“°ì§€ ë§ê³  ì•„ì´ì½˜ì„ í•¨ê»˜ ì‚¬ìš©í•˜ì„¸ìš”. ìƒ‰ë§¹ ì‚¬ìš©ìžëŠ” ë¹¨ê°•ê³¼ ì´ˆë¡ì„ êµ¬ë³„í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.</li>
                                </ul>`},
                            {id:'marketing', title:'ðŸ“£ ë§ˆì¼€íŒ… & ë¸Œëžœë”©', content:`
                                <ul class="list-disc pl-4 space-y-2">
                                    <li><strong>CTA ë²„íŠ¼:</strong> íŽ˜ì´ì§€ ë‚´ì—ì„œ ìœ ì¼í•˜ê²Œ íŠ€ëŠ” ìƒ‰(ê°•ì¡°ìƒ‰)ì´ì–´ì•¼ í´ë¦­ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.</li>
                                    <li><strong>ë¸Œëžœë“œ ì¼ê´€ì„±:</strong> ë¡œê³  ìƒ‰ìƒì„ ê·¸ëŒ€ë¡œ UIì— ì“°ê¸°ë³´ë‹¤, ì±„ë„ì™€ ëª…ë„ë¥¼ ì¡°ì ˆí•œ íŒ”ë ˆíŠ¸ë¥¼ ë³„ë„ë¡œ ì •ì˜í•˜ì„¸ìš”.</li>
                                    <li><strong>íƒ€ê²Ÿ ì˜¤ë””ì–¸ìŠ¤:</strong> 10-20ëŒ€ëŠ” ê³¼ê°í•˜ê³  ì±„ë„ ë†’ì€ ìƒ‰(ë„¤ì˜¨, ë¹„ë¹„ë“œ)ì„, 40-50ëŒ€ëŠ” ì°¨ë¶„í•˜ê³  ê¹Šì€ ìƒ‰(ë„¤ì´ë¹„, ì™€ì¸)ì„ ì„ í˜¸í•©ë‹ˆë‹¤.</li>
                                    <li><strong>ê³„ì ˆê°:</strong> ë´„(íŒŒìŠ¤í…”), ì—¬ë¦„(ë¹„ë¹„ë“œ/ì¿¨), ê°€ì„(ë”¥/ì›œ), ê²¨ìš¸(ê³ ëŒ€ë¹„/ì¿¨) ë§ˆì¼€íŒ… ì‹œì¦Œì— ë§žì¶° í†¤ì„ ì¡°ì •í•˜ì„¸ìš”.</li>
                                </ul>`},
                            {id:'trend', title:'âœ¨ íŠ¸ë Œë“œ & í…Œí¬ë‹‰', content:`
                                <ul class="list-disc pl-4 space-y-2">
                                    <li><strong>ê·¸ë¼ë””ì–¸íŠ¸:</strong> ë‘ ìƒ‰ìƒì˜ ì°¨ì´ê°€ í¬ì§€ ì•Šì€ 'ë¯¸ë¬˜í•œ ê·¸ë¼ë””ì–¸íŠ¸'ê°€ íŠ¸ë Œë“œìž…ë‹ˆë‹¤. </li>
                                    <li><strong>ê¸€ëž˜ìŠ¤ëª¨í”¼ì¦˜:</strong> ë°°ê²½ì„ íë¦¬ê²Œ(Blur) í•˜ê³  ë°˜íˆ¬ëª…í•œ í°ìƒ‰ì„ ì˜¬ë ¤ ìœ ë¦¬ ì§ˆê°ì„ ë§Œë“œì„¸ìš”.</li>
                                    <li><strong>ë„¤ì˜¤ ë¸Œë£¨íƒˆë¦¬ì¦˜:</strong> ê³ ì±„ë„ ì›ìƒ‰ + êµµì€ ê²€ì • í…Œë‘ë¦¬ + ê·¸ë¦¼ìž ì—†ìŒ. íž™í•˜ê³  ì Šì€ ëŠë‚Œì„ ì¤ë‹ˆë‹¤.</li>
                                    <li><strong>ë©”ì‰¬ ê·¸ë¼ë””ì–¸íŠ¸:</strong> 3-4ê°€ì§€ ìƒ‰ìƒì„ ë¶ˆê·œì¹™í•˜ê²Œ ì„žì–´ ëª½í™˜ì ì¸ ë°°ê²½ì„ ë§Œë“œëŠ” ê¸°ë²•ìž…ë‹ˆë‹¤.</li>
                                </ul>`},
                            {id:'a11y', title:'ðŸ‘“ ì ‘ê·¼ì„± (Accessibility)', content:`
                                <ul class="list-disc pl-4 space-y-2">
                                    <li><strong>ëª…ì•”ë¹„ 4.5:1:</strong> í…ìŠ¤íŠ¸ì™€ ë°°ê²½ì˜ ëª…ì•”ë¹„ ìµœì†Œ ê¸°ì¤€(WCAG AA). ChromaZenì˜ ë°°ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”.</li>
                                    <li><strong>í° í…ìŠ¤íŠ¸ 3:1:</strong> 18pt ì´ìƒ êµµì€ í…ìŠ¤íŠ¸ëŠ” 3:1 ëª…ì•”ë¹„ë„ í—ˆìš©ë©ë‹ˆë‹¤.</li>
                                    <li><strong>ìƒ‰ìƒ ë‹¨ë… ì‚¬ìš© ê¸ˆì§€:</strong> ë§í¬ë‚˜ ì—ëŸ¬ í‘œì‹œì— ìƒ‰ìƒë§Œ ì“°ì§€ ë§ê³  ë°‘ì¤„ì´ë‚˜ ì•„ì´ì½˜ì„ ë³‘í–‰í•˜ì„¸ìš”.</li>
                                    <li><strong>í‘ë°± í…ŒìŠ¤íŠ¸:</strong> 'Grayscale' ëª¨ë“œì—ì„œë„ ì •ë³´ì˜ ìœ„ê³„ì™€ êµ¬ë¶„ì´ ëª…í™•í•œì§€ í•­ìƒ í™•ì¸í•˜ì„¸ìš”.</li>
                                </ul>`}
                        ] : [
                            {id:'basic', title:'ðŸ“ The Basics (Rules)', content:`
                                <ul class="list-disc pl-4 space-y-2">
                                    <li><strong>60-30-10 Rule:</strong> 60% Background (Dominant), 30% Content (Secondary), 10% CTA (Accent).</li>
                                    <li><strong>Monochromatic:</strong> Easiest way to look professional. Use variations in lightness of a single hue.</li>
                                    <li><strong>Analogous:</strong> Colors next to each other on the wheel. Serene and comfortable designs.</li>
                                    <li><strong>Complementary:</strong> Opposite colors. High contrast, great for popping elements but risky for text.</li>
                                </ul>`},
                            {id:'psy', title:'ðŸ§  Color Psychology', content:`
                                <ul class="list-disc pl-4 space-y-2">
                                    <li><strong>Blue:</strong> Trust, Security. #1 choice for Finance and Tech.</li>
                                    <li><strong>Red:</strong> Energy, Urgency. Raises heart rate. Use for Sales/Errors.</li>
                                    <li><strong>Green:</strong> Growth, Health, Money. Easiest on the eyes.</li>
                                    <li><strong>Yellow:</strong> Optimism, Warning. Most visible color against black.</li>
                                    <li><strong>Purple:</strong> Creativity, Luxury, Mystery.</li>
                                    <li><strong>Orange:</strong> Friendly, Affordable, Energetic.</li>
                                </ul>`},
                            {id:'uiux', title:'ðŸ’» UI/UX Pro Tips', content:`
                                <ul class="list-disc pl-4 space-y-2">
                                    <li><strong>Dark Mode:</strong> Avoid #000000. Use Dark Grey (#121212) to reduce eye strain and smearing.</li>
                                    <li><strong>Colored Shadows:</strong> Use a very dark shade of your primary color for shadows instead of pure black.</li>
                                    <li><strong>Text Hierarchy:</strong> Use shades of grey (#111, #444, #888) to denote importance, not just size.</li>
                                    <li><strong>Avoid Pure Grey:</strong> Always add a tiny bit of blue or yellow tint to your greys for a richer look.</li>
                                    <li><strong>Backgrounds:</strong> Off-white (#F9F9F9) often looks more premium than pure white (#FFF).</li>
                                </ul>`},
                            {id:'marketing', title:'ðŸ“£ Marketing & Branding', content:`
                                <ul class="list-disc pl-4 space-y-2">
                                    <li><strong>CTA Buttons:</strong> Should be the most vibrant/distinct color on the page to maximize clicks.</li>
                                    <li><strong>Audience:</strong> Gen Z prefers bold/neon colors; Older demographics prefer muted/deep tones.</li>
                                    <li><strong>Consistency:</strong> Define a palette and stick to it. Repetition builds brand recognition.</li>
                                </ul>`},
                            {id:'trend', title:'âœ¨ Trends & Techniques', content:`
                                <ul class="list-disc pl-4 space-y-2">
                                    <li><strong>Subtle Gradients:</strong> Use closely related colors for a modern, flat-plus look.</li>
                                    <li><strong>Glassmorphism:</strong> Background blur + semi-transparent white overlays.</li>
                                    <li><strong>Mesh Gradients:</strong> Blending multiple freeform color blobs for a dreamy background.</li>
                                </ul>`},
                            {id:'a11y', title:'ðŸ‘“ Accessibility', content:`
                                <ul class="list-disc pl-4 space-y-2">
                                    <li><strong>Contrast 4.5:1:</strong> The gold standard for text readability. Check the badges in this app.</li>
                                    <li><strong>Don't rely on color alone:</strong> Use icons or underlines for errors/links, not just red/blue color.</li>
                                    <li><strong>Grayscale Test:</strong> If it works in black & white, it works in color. Use the toggle to check.</li>
                                </ul>`}
                        ];

                        return `<div class="space-y-2 pb-4">
                            ${sections.map(s => `
                                <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
                                    <button onclick="App.ui.toggleHelpSection('${s.id}')" class="w-full flex justify-between items-center p-3 text-left bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                        <span class="font-bold text-sm text-gray-800 dark:text-gray-200">${s.title}</span>
                                        <i data-lucide="chevron-down" id="arrow-${s.id}" class="help-arrow w-4 h-4 transition-transform text-gray-400"></i>
                                    </button>
                                    <div id="${s.id}" class="help-section-content hidden p-4 text-sm text-gray-600 dark:text-gray-300 bg-white dark:bg-dark-surface leading-relaxed">
                                        ${s.content}
                                    </div>
                                </div>
                            `).join('')}
                        </div>`;
                    }
                },
                renderPresets: () => {
                    const grid = document.getElementById('presets-grid');
                    grid.innerHTML = '';
                    
                    Object.entries(PRESET_CATEGORIES).forEach(([cat, items]) => {
                        const section = document.createElement('div');
                        section.innerHTML = `<h4 class="text-[10px] font-bold text-gray-400 dark:text-dark-muted uppercase tracking-wider mb-2 mt-4 first:mt-0">${cat}</h4>`;
                        const itemGrid = document.createElement('div');
                        itemGrid.className = 'grid grid-cols-2 gap-2';
                        
                        items.forEach(p => {
                            const isActive = App.state.preset === p;
                            const activeClass = isActive 
                                ? 'bg-gray-900 text-white dark:bg-gray-100 dark:text-black border-transparent shadow-md' 
                                : 'bg-gray-50 dark:bg-dark-bg border-gray-100 dark:border-dark-border text-gray-600 dark:text-gray-300 hover:border-gray-300';
                            
                            const btn = document.createElement('button');
                            btn.className = `py-2 px-3 rounded-lg border transition-all text-left flex items-center gap-2 ${activeClass}`;
                            btn.onclick = () => App.logic.togglePreset(p);
                            btn.onmouseenter = () => App.ui.updateInfo(App.logic.getInfoText(p));
                            btn.onmouseleave = () => App.ui.resetInfo();
                            btn.innerHTML = `<span class="w-3 h-3 rounded-full bg-gradient-to-br from-gray-300 to-gray-500"></span><span class="text-xs font-medium capitalize">${p}</span>`;
                            itemGrid.appendChild(btn);
                        });
                        section.appendChild(itemGrid);
                        grid.appendChild(section);
                    });
                },
                renderLibrary: () => {
                    const container = document.getElementById('library-container');
                    if(App.state.library.length === 0) { container.innerHTML = '<p class="text-xs text-gray-400 text-center mt-8">ì €ìž¥ëœ íŒ”ë ˆíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
                    container.innerHTML = App.state.library.map((item, idx) => `
                        <div class="bg-gray-50 dark:bg-dark-bg p-2 rounded-lg border border-gray-100 dark:border-dark-border flex items-center justify-between group">
                            <div class="flex-1 flex h-8 rounded overflow-hidden cursor-pointer mr-3" onclick="App.logic.loadSaved(${idx})">${item.colors.map(c => `<div style="background:${c}" class="flex-1 h-full"></div>`).join('')}</div>
                            <button onclick="App.logic.deleteSaved(${idx})" class="text-gray-400 hover:text-red-500 p-1"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                        </div>`).join('');
                },
                switchSidebarTab: (tab) => {
                    App.state.activeTab = tab;
                    const isPresets = tab === 'presets';
                    const isLibrary = tab === 'library';
                    const isHistory = tab === 'history';

                    document.getElementById('sidebar-presets').classList.toggle('hidden', !isPresets);
                    document.getElementById('sidebar-library').classList.toggle('hidden', !isLibrary);
                    document.getElementById('sidebar-history').classList.toggle('hidden', !isHistory);

                    const setTabStyle = (id, active) => {
                        const el = document.getElementById(id);
                        el.classList.toggle('border-transparent', !active);
                        el.classList.toggle('border-black', active);
                        el.classList.toggle('dark:border-white', active);
                        el.classList.toggle('text-black', active);
                        el.classList.toggle('dark:text-white', active);
                        el.classList.toggle('text-gray-400', !active);
                    };

                    setTabStyle('tab-presets', isPresets);
                    setTabStyle('tab-library', isLibrary);
                    setTabStyle('tab-history', isHistory);

                    if(isHistory) App.ui.renderHistory();
                },
                openTuneModal: (idx) => {
                    App.state.editingIndex = idx; const c = App.state.colors[idx];
                    const content = `<div class="bg-white dark:bg-dark-surface rounded-2xl shadow-2xl w-full max-w-sm p-6 transform scale-100 transition-transform">
                            <h3 class="font-bold text-lg mb-4 dark:text-white">Edit Color</h3>
                            <div class="w-full h-24 rounded-xl mb-4" style="background:${c.hex}" id="tune-preview"></div>
                            <div class="flex gap-2 mb-4"><span class="flex items-center justify-center w-10 bg-gray-100 dark:bg-dark-bg rounded-lg text-gray-500">#</span><input type="text" value="${c.hex.replace('#','')}" class="flex-1 bg-gray-50 dark:bg-dark-bg rounded-lg px-3 font-mono uppercase focus:ring-2 focus:ring-indigo-500 outline-none dark:text-white" maxlength="6" oninput="App.ui.updateTuneHex(this.value)"></div>
                            <div class="space-y-4"><div><label class="text-xs font-bold text-gray-400">Saturation</label><input type="range" min="0" max="100" value="${c.s}" class="w-full" oninput="App.ui.updateTuneHsl('s', this.value)"></div><div><label class="text-xs font-bold text-gray-400">Lightness</label><input type="range" min="0" max="100" value="${c.l}" class="w-full" oninput="App.ui.updateTuneHsl('l', this.value)"></div></div>
                            <div class="flex justify-end gap-2 mt-6"><button onclick="App.ui.closeModal()" class="px-4 py-2 text-sm font-bold text-gray-500 hover:bg-gray-100 dark:hover:bg-dark-bg rounded-lg">Cancel</button><button onclick="App.ui.applyTune()" class="px-4 py-2 text-sm font-bold bg-black dark:bg-white text-white dark:text-black rounded-lg">Apply</button></div></div>`;
                    App.ui.showModal(content);
                },
                updateTuneHsl: (type, val) => {
                    const c = App.state.colors[App.state.editingIndex];
                    if(type === 's') c.s = parseInt(val); if(type === 'l') c.l = parseInt(val);
                    c.hex = App.utils.hslToHex(c.h, c.s, c.l);
                    document.getElementById('tune-preview').style.backgroundColor = c.hex;
                },
                updateTuneHex: (val) => {
                    if(val.length === 6) {
                        const hsl = App.utils.hexToHsl('#'+val); App.state.colors[App.state.editingIndex] = hsl;
                        document.getElementById('tune-preview').style.backgroundColor = '#' + val;
                    }
                },
                applyTune: () => { App.ui.render(); App.ui.closeModal(); },
                showModal: (html) => {
                    const container = document.getElementById('modal-container'); container.innerHTML = html; container.classList.remove('hidden'); requestAnimationFrame(() => container.classList.remove('opacity-0'));
                },
                closeModal: () => {
                    const container = document.getElementById('modal-container'); container.classList.add('opacity-0'); setTimeout(() => container.classList.add('hidden'), 200);
                },
                toggleExportMenu: (e) => { e.stopPropagation(); document.getElementById('export-menu').classList.toggle('hidden'); },
                showToast: (msg) => {
                    const t = document.getElementById('toast'); t.innerText = msg; t.classList.remove('opacity-0', 'pointer-events-none', 'translate-y-4'); setTimeout(() => t.classList.add('opacity-0', 'pointer-events-none', 'translate-y-4'), 2500);
                },
                updateSliderLabel: (val) => {
                    App.state.variability = parseInt(val); document.getElementById('variability-label').innerText = val < 20 ? 'Tight' : val > 70 ? 'Wide' : 'Medium';
                },
                toggleGrain: () => {}, // removed
                toggleDarkMode: () => {
                    App.state.darkMode = !App.state.darkMode; document.body.classList.toggle('dark'); localStorage.setItem('chromazen_dark', App.state.darkMode);
                },
                updateInfo: (text) => { document.getElementById('info-text').innerText = text; },
                resetInfo: () => { document.getElementById('info-text').innerText = 'Hover over controls or presets for details.'; },
                setFont: (font) => {
                    App.state.typoFont = font;
                    // ... implementation moved to setTypoStyle
                },
                toggleSound: () => {
                    App.state.soundEnabled = !App.state.soundEnabled;
                    const btn = document.getElementById('btn-sound');
                    btn.innerHTML = App.state.soundEnabled 
                        ? '<i data-lucide="volume-2" class="w-5 h-5"></i>' 
                        : '<i data-lucide="volume-x" class="w-5 h-5"></i>';
                    if(window.lucide) lucide.createIcons();
                    App.ui.showToast(App.state.soundEnabled ? 'ì‚¬ìš´ë“œ ì¼œì§' : 'ì‚¬ìš´ë“œ êº¼ì§');
                },
                toggleGrayscale: () => {
                    App.state.grayscaleMode = !App.state.grayscaleMode;
                    const main = document.getElementById('app-main');
                    if (App.state.grayscaleMode) main.classList.add('grayscale'); else main.classList.remove('grayscale');
                    const btn = document.getElementById('btn-grayscale');
                    btn.innerHTML = App.state.grayscaleMode ? '<i data-lucide="eye-off" class="w-5 h-5 text-blue-500"></i>' : '<i data-lucide="eye" class="w-5 h-5"></i>';
                    if(window.lucide) lucide.createIcons();
                    App.ui.showToast(App.state.grayscaleMode ? 'í‘ë°± ëª¨ë“œ ì¼œì§' : 'í‘ë°± ëª¨ë“œ êº¼ì§');
                },
            },
            exports: {
                css: () => { const css = `:root {\n${App.state.colors.map((c,i) => `  --color-${i===0?'primary':i===1?'secondary':i===2?'accent':i+1}: ${c.hex};`).join('\n')}\n}`; App.utils.copy(css); },
                tailwind: () => { const config = `colors: {\n${App.state.colors.map((c,i) => `  '${i===0?'primary':i===1?'secondary':i===2?'accent':i+1}': '${c.hex}',`).join('\n')}\n}`; App.utils.copy(config); },
                ase: () => { App.ui.showToast('ASE download started...'); },
                image: () => {
                    const area = document.getElementById('export-palette-area'); const code = document.getElementById('export-codes');
                    area.innerHTML = App.state.colors.map(c => `<div style="background:${c.hex}" class="flex-1 h-full"></div>`).join('');
                    code.innerHTML = App.state.colors.map(c => `<span>${c.hex}</span>`).join('');
                    html2canvas(document.getElementById('export-container')).then(canvas => {
                        const a = document.createElement('a'); a.download = 'chromazen-palette.png'; a.href = canvas.toDataURL(); a.click();
                    });
                }
            }
        };
        // Fix: Ensure DOM is loaded before init to avoid null reference errors
        window.addEventListener('DOMContentLoaded', () => {
            App.logic.init();
        });
    </script>
</body>
</html>
